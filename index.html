<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מתורגמן חכם - עובד-מנהל</title>

    <!-- Tailwind CSS CDN - משמש לעיצוב מהיר ומודרני -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* פונט Heebo מתאים לעברית ולמראה נקי */
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');
        /* פונט לתאית */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');
    </style>

    <!-- simple-keyboard CSS CDN - עבור המקלדת הווירטואלית -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">

    <style>
        /* הגדרות פונט וריסט כלליות לגוף הדף */
        body {
            font-family: 'Heebo', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            /* רקע כחול-לבן עם הדרגתיות */
            background: linear-gradient(135deg, #e0f2fe 0%, #bbdefb 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px; /* הגדל פדינג כללי */
            gap: 32px; /* מרווח גדול יותר בין סקשנים */
        }

        /* הסתרת נגן האודיו המובנה של הדפדפן */
        audio {
            display: none;
        }

        /* עיצוב זכוכית (Glassmorphism) לפאנלים ולחלק מהכפתורים */
        .glass-panel {
            background-color: rgba(255, 255, 255, 0.6); /* רקע לבן שקוף */
            backdrop-filter: blur(10px); /* אפקט טשטוש */
            border: 1px solid rgba(255, 255, 255, 0.3); /* גבול שקוף */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); /* צל עדין */
            border-radius: 20px; /* פינות עגולות יותר */
        }

        /* הגדרות בסיסיות של simple-keyboard כדי להתאים לעיצוב הכללי של Tailwind */
        .simple-keyboard {
            @apply glass-panel p-6 max-w-4xl mx-auto;
        }
        .simple-keyboard .hg-button {
            @apply rounded-xl text-lg font-medium text-gray-800 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-all duration-150;
            padding: 0.8rem 0.5rem;
        }
        .simple-keyboard .hg-button.hg-standardBtn {
            @apply h-14;
        }
        .simple-keyboard .hg-button.hg-functionBtn {
            @apply bg-blue-500 text-white hover:bg-blue-600;
        }
        .simple-keyboard .hg-button.hg-button-space {
            @apply w-full;
        }
        .simple-keyboard .hg-button-shift,
        .simple-keyboard .hg-button-capslock,
        .simple-keyboard .hg-button-tab,
        .simple-keyboard .hg-button-bksp {
            @apply bg-gray-300 text-gray-800 hover:bg-gray-400;
        }
        .simple-keyboard .hg-button-shift:active,
        .simple-keyboard .hg-button-capslock:active {
            @apply bg-gray-500;
        }
        .simple-keyboard .hg-row .hg-button {
            line-height: normal;
        }

        /* אנימציית הבהוב עבור הפופאפ - מושך תשומת לב */
        @keyframes pulse-once {
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 rgba(0, 0, 0, 0); }
            50% { transform: scale(1.02); opacity: 1; box-shadow: 0 0 20px rgba(0, 0, 0, 0.4); }
            100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 rgba(0, 0, 0, 0); }
        }

        @keyframes urgent-pulse {
            0% { background-color: rgba(255, 99, 71, 0.7); box-shadow: 0 0 15px rgba(255, 99, 71, 0.8); }
            50% { background-color: rgba(255, 140, 0, 0.7); box-shadow: 0 0 30px rgba(255, 140, 0, 0.8); }
            100% { background-color: rgba(255, 99, 71, 0.7); box-shadow: 0 0 15px rgba(255, 99, 71, 0.8); }
        }

        .popup-animate {
            animation: pulse-once 1.5s ease-out forwards;
        }
        .urgent-popup-animate {
            animation: urgent-pulse 1s infinite alternate; /* אנימציה מתחלפת ואגרסיבית יותר */
        }

        /* אנימציית ברק וקשת צבעים למסך התרגום הראשי */
        @keyframes rainbow-glow {
            0% { border-color: #ff0000; box-shadow: 0 0 15px #ff0000; }
            16% { border-color: #ff7f00; box-shadow: 0 0 15px #ff7f00; }
            33% { border-color: #ffff00; box-shadow: 0 0 15px #ffff00; }
            50% { border-color: #00ff00; box-shadow: 0 0 15px #00ff00; }
            66% { border-color: #0000ff; box-shadow: 0 0 15px #0000ff; }
            83% { border-color: #4b0082; box-shadow: 0 0 15px #4b0082; }
            100% { border-color: #9400d3; box-shadow: 0 0 15px #9400d3; }
        }

        .rainbow-border {
            border: 4px solid; /* עבה יותר בשביל האפקט */
            animation: rainbow-glow 3s infinite alternate; /* אנימציה אינסופית ומתחלפת */
        }
        
        /* אפקט הקלדה */
        .typing-effect::after {
            content: '|';
            animation: blink-caret .75s step-end infinite;
        }

        @keyframes blink-caret {
            from, to { border-right-color: transparent }
            50% { border-right-color: black; }
        }

        /* פונט עבור טקסט תאית */
        .thai-text {
            font-family: 'Noto Sans Thai', sans-serif;
        }

        /* התאמה לרספונסיביות של המקלדת */
        @media (max-width: 768px) {
            .simple-keyboard .hg-button {
                font-size: 0.9em;
                padding: 0.5rem 0.3rem;
            }
            .simple-keyboard .hg-button.hg-standardBtn {
                height: 3.5rem; /* גובה קטן יותר למסכים קטנים */
            }
        }

        /* עיצוב כפתור בזמן ספירה לאחור */
        @keyframes border-sparkle {
            0% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
            25% { border-color: #ff7f00; box-shadow: 0 0 15px #ff7f00; }
            50% { border-color: #ffff00; box-shadow: 0 0 20px #ffff00; }
            75% { border-color: #ff7f00; box-shadow: 0 0 15px #ff7f00; }
            100% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
        }

        .countdown-button {
            background-color: #ffc107 !important; /* צבע צהוב בזמן ספירה */
            color: #333 !important; /* טקסט כהה יותר */
            pointer-events: none; /* מונע לחיצות נוספות */
            transform: scale(1.05); /* אפקט קטן של הגדלה */
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.7);
            border: 3px solid transparent; /* גבול התחלתי שקוף לאנימציה */
            animation: border-sparkle 1s infinite alternate; /* אנימציית הברקה על הגבול */
        }

        /* סגנון למסך התרגום הראשי החדש */
        #mainTranslationDisplay {
            min-height: 150px; /* גובה מינימלי למסך */
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 40px 0 rgba(31, 38, 135, 0.4);
            border-radius: 25px;
            font-size: 3.5rem; /* גודל פונט גדול במיוחד */
            font-weight: 700; /* בולד */
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            overflow: hidden; /* למקרה של גלישת טקסט באנימציית הקלדה */
            position: relative;
            z-index: 10; /* וודא שהוא מעל שאר התוכן */
        }
        /* התאמות למסכים קטנים עבור המסך הראשי */
        @media (max-width: 768px) {
            #mainTranslationDisplay {
                font-size: 2.5rem; /* קטן יותר לנייד */
                min-height: 120px;
            }
        }
        @media (max-width: 480px) {
            #mainTranslationDisplay {
                font-size: 1.8rem;
                min-height: 100px;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-white min-h-screen flex flex-col items-center p-6 space-y-8">

    <!-- מסך תרגום ראשי דינמי -->
    <div id="mainTranslationDisplay" class="w-full max-w-4xl glass-panel">
        <span id="mainDisplayText"></span>
    </div>

    <div class="w-full max-w-7xl flex flex-wrap lg:flex-nowrap justify-center gap-8">
        <!-- פאנל עובד תאילנדי - בקשות למנהל -->
        <div class="glass-panel p-8 flex-1 flex flex-col items-center min-w-[320px] sm:min-w-[45%] lg:min-w-[45%] bg-green-50/50">
            <h2 class="text-3xl font-bold text-green-700 mb-6">עובד תאילנדי (בקשות למנהל)</h2>
            <div id="thaiWorkerPanel" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 w-full">
                <!-- כפתורים ייווצרו כאן באופן דינמי באמצעות JavaScript -->
            </div>
        </div>

        <!-- פאנל מנהל - הוראות לעובד -->
        <div class="glass-panel p-8 flex-1 flex flex-col items-center min-w-[320px] sm:min-w-[45%] lg:min-w-[45%] bg-blue-50/50">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">מנהל (הוראות לעובד)</h2>
            <div id="managerPanel" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 w-full">
                <!-- כפתורים ייווצרו כאן באופן דינמי באמצעות JavaScript -->
            </div>
        </div>
    </div>

    <!-- פאנל משפטי תרגום מיידי (הוחזר למקומו המקורי כאזור משני) -->
    <div class="glass-panel p-8 w-full max-w-7xl flex flex-col items-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">משפטי תרגום מיידי</h2>
        <div class="flex flex-wrap justify-center gap-4 mb-8 w-full">
            <!-- כפתורים למשפטים בעברית -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">עברית לתאית</h3>
                <div id="instantPhrasesHe" class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full">
                    <!-- כפתורי משפטים ייווצרו כאן -->
                </div>
            </div>
            <!-- כפתורים למשפטים בתאית -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">תאית לעברית</h3>
                <div id="instantPhrasesTh" class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full">
                    <!-- כפתורי משפטים ייווצרו כאן -->
                </div>
            </div>
              <!-- כפתורי מספרים 1-10 בעברית -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5 mt-8">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">מספרים (עברית לתאית)</h3>
                <div id="numberPhrasesHe" class="grid grid-cols-2 sm:grid-cols-3 gap-4 w-full">
                    <!-- כפתורי מספרים ייווצרו כאן -->
                </div>
            </div>
            <!-- כפתורי מספרים 1-10 בתאית -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5 mt-8">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">ตัวเลข (תאית לעברית)</h3>
                <div id="numberPhrasesTh" class="grid grid-cols-2 sm:grid-cols-3 gap-4 w-full">
                    <!-- כפתורי מספרים ייווצרו כאן -->
                </div>
            </div>
        </div>
        <!-- אזור להצגת המשפט המתורגם המיידי - נשאר עבור תרגום מהיר של כפתורים אלו -->
        <div id="instantTranslationOutput" class="mt-8 p-6 text-2xl font-bold text-gray-900 bg-gray-50 rounded-2xl border-4 border-transparent min-h-[100px] flex items-center justify-center w-full max-w-2xl text-center shadow-lg transition-all duration-300">
            המשפט המתורגם יופיע כאן (תרגום מיידי מכפתורים).
        </div>
    </div>

    <!-- פאנל תרגום וכתיבה חופשית -->
    <div class="glass-panel p-8 w-full max-w-7xl flex flex-col items-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">תרגום וכתיבה חופשית</h2>
        <textarea id="freeTextInput" placeholder="הקלד כאן טקסט בעברית או בתאית..." rows="4"
                  class="w-full p-4 mb-6 text-xl border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-all resize-y shadow-sm"></textarea>
        <div class="flex flex-wrap justify-center gap-4 mb-8 w-full">
            <button id="setLangHe" class="px-8 py-4 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 transition-all text-xl">
                הקלד בעברית
            </button>
            <button id="setLangTh" class="px-8 py-4 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 transition-all text-xl thai-text">
                พิมพ์ภาษาไทย
            </button>
            <button id="speakTranslated" class="px-8 py-4 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition-all text-xl">
                השמע טקסט מתורגם
            </button>
        </div>
        <div class="simple-keyboard w-full"></div>
    </div>

    <!-- חלון פופאפ (Popup) - שכבת על נסתרת שתופיע בלחיצה על כפתור -->
    <div id="popupOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div id="popupContent" class="glass-panel p-10 flex flex-col items-center justify-center max-w-lg w-11/12 transform scale-0 opacity-0 transition-all duration-300 ease-out relative">
            <p id="popupText" class="text-4xl font-bold text-center mb-8 text-gray-800"></p>
            <button id="popupReplayButton" class="px-8 py-4 bg-purple-600 text-white font-semibold rounded-full shadow-lg hover:bg-purple-700 transition-all duration-200 text-2xl">
                🔊 השמע שוב
            </button>
            <button id="popupCloseButton" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-3xl font-bold">
                &times;
            </button>
            <span id="urgentIcon" class="absolute top-4 left-4 text-5xl hidden">🔔</span>
        </div>
    </div>

    <!-- אלמנט אודיו לצליל פעמון - צליל קצר וחזק ללחיצה -->
    <audio id="bellSound" src="data:audio/mpeg;base64,TBD_BELL_SOUND_BASE64_AUDIO_HERE"></audio>

    <!-- simple-keyboard JS CDN - עבור המקלדת הווירטואלית -->
    <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>

    <script>
        // הערה: ה-SERVER_URL הוסר מכיוון שהתרגום כעת מתבצע ישירות מול ה-Gemini API.
        // עבור קבצי אודיו של משפטים קבועים, עליך למלא את ה-Base64 בקבצי אודיו אמיתיים.

        let currentAudio = null; // משתנה לשמירה על נגן האודיו הנוכחי

        // אלמנטים של הפופאפ ב-HTML
        const popupOverlay = document.getElementById('popupOverlay');
        const popupContent = document.getElementById('popupContent');
        const popupText = document.getElementById('popupText');
        const popupReplayButton = document.getElementById('popupReplayButton');
        const popupCloseButton = document.getElementById('popupCloseButton');
        const urgentIcon = document.getElementById('urgentIcon'); // אייקון התראה
        let popupAudioUrl = ''; // ישמור את ה-URL של האודיו שהושמע בפופאפ
        let popupCloseTimeout; // משתנה לשמירת הטיים-אאוט של סגירת הפופאפ אוטומטית

        // אלמנטים של תרגום מיידי
        const instantTranslationOutput = document.getElementById('instantTranslationOutput');
        const mainTranslationDisplay = document.getElementById('mainTranslationDisplay');
        const mainDisplayText = document.getElementById('mainDisplayText');

        // אלמנט צלצול פעמון
        const bellSound = document.getElementById('bellSound');

        // הגדרות מקלדת וירטואלית SimpleKeyboard
        let keyboard;
        let currentKeyboardLayout = 'hebrew'; // ברירת מחדל: עברית

        // פריסות מקלדת עבור עברית ותאית (דוגמאות בסיסיות)
        const layoutOptions = {
            'hebrew': {
                default: [
                    "` 1 2 3 4 5 6 7 8 9 0 - = {bksp}",
                    "{tab} / ' ק ר ו ן ט צ ש ד ג כ ע ח י ל ף ,",
                    "{capslock} ז ס ב ה נ מ ך ף , . / \\",
                    "{shift} ת א ד ה ב ג ו ח ז ל ט ר נ מ {shift}",
                    "{space}"
                ],
                shift: [
                    "~ ! @ # $ % ^ & * ( ) _ + {bksp}",
                    "{tab} Q W E R T Y U I O P { } |",
                    "{capslock} A S D F G H J K L : \"",
                    "{shift} Z X C V B N M < > ? {shift}",
                    "{space}"
                ]
            },
            'thai': {
                default: [
                    "ๅ / - ภ ถุ ู กึ หิ ่ ้ ็ ื {bksp}",
                    "{tab} พั รน ะ ตร ยบ ุย อิ โ โอ ป ก ฬ",
                    "{capslock} า ส ด ฟ แ ะั ห โ ค ช",
                    "{shift} ซษ มอ ดบ น เ ท จ ก ็ {shift}",
                    "{space}"
                ],
                shift: [
                    "+ ๑ ๒ ๓ ๔ ๕ ๖ ๗ ๘ ๙ ๐ ฯ ญ ฏ {bksp}",
                    "{tab} ฎ ฑ ธ ํ ๊ ณ ม ย ณบ ุุ ณข ณค ณง {tab}",
                    "{capslock} ฟะ หะ กะ ดะ สั ะั น ะร ะล ะอ ะใ {capslock}",
                    "{shift} ะม ะน ะว ะอ ะร ะส ะฟ ะง ะจ ะค ะล {shift}",
                    "{space}"
                ]
            }
        };

        // מאגר קבצי אודיו בפורמט Base64
        // חשוב: אלו הם קבצי דמה. עליך להחליף את ה-Base64 בקבצי אודיו אמיתיים משלך.
        // תוכל להשתמש בכלים מקוונים או סקריפטים כדי להמיר קבצי MP3/WAV ל-Base64.
        const base64AudioData = {
            "he_break_1": "data:audio/mpeg;base64,TBD_HE_BREAK_1_BASE64_AUDIO_HERE",
            "th_break_1": "data:audio/mpeg;base64,TBD_TH_BREAK_1_BASE64_AUDIO_HERE",
            "he_toilet_1": "data:audio/mpeg;base64,TBD_HE_TOILET_1_BASE64_AUDIO_HERE",
            "th_toilet_1": "data:audio/mpeg;base64,TBD_TH_TOILET_1_BASE64_AUDIO_HERE",
            "he_help_1": "data:audio/mpeg;base64,TBD_HE_HELP_1_BASE64_AUDIO_HERE",
            "th_help_1": "data:audio/mpeg;base64,TBD_TH_HELP_1_BASE64_AUDIO_HERE",
            "he_sick_1": "data:audio/mpeg;base64,TBD_HE_SICK_1_BASE64_AUDIO_HERE",
            "th_sick_1": "data:audio/mpeg;base64,TBD_TH_SICK_1_BASE64_AUDIO_HERE",
            "he_load_cement_1": "data:audio/mpeg;base64,TBD_HE_LOAD_CEMENT_1_BASE64_AUDIO_HERE",
            "th_load_cement_1": "data:audio/mpeg;base64,TBD_TH_LOAD_CEMENT_1_BASE64_AUDIO_HERE",
            "he_load_bags_1": "data:audio/mpeg;base64,TBD_HE_LOAD_BAGS_1_BASE64_AUDIO_HERE",
            "th_load_bags_1": "data:audio/mpeg;base64,TBD_TH_LOAD_BAGS_1_BASE64_AUDIO_HERE",
            "he_help_alaa_1": "data:audio/mpeg;base64,TBD_HE_HELP_ALAA_1_BASE64_AUDIO_HERE",
            "th_help_alaa_1": "data:audio/mpeg;base64,TBD_TH_HELP_ALAA_1_BASE64_AUDIO_HERE",
            "he_help_adham_1": "data:audio/mpeg;base64,TBD_HE_HELP_ADHAM_1_BASE64_AUDIO_HERE",
            "th_help_adham_1": "data:audio/mpeg;base64,TBD_TH_HELP_ADHAM_1_BASE64_AUDIO_HERE",
            "he_help_store_1": "data:audio/mpeg;base64,TBD_HE_HELP_STORE_1_BASE64_AUDIO_HERE",
            "th_help_store_1": "data:audio/mpeg;base64,TBD_TH_HELP_STORE_1_BASE64_AUDIO_HERE",
            "he_next_product_1": "data:audio/mpeg;base64,TBD_HE_NEXT_PRODUCT_1_BASE64_AUDIO_HERE",
            "th_next_product_1": "data:audio/mpeg;base64,TBD_TH_NEXT_PRODUCT_1_BASE64_AUDIO_HERE",
            "he_good_morning_1": "data:audio/mpeg;base64,TBD_HE_GOOD_MORNING_1_BASE64_AUDIO_HERE",
            "th_good_morning_1": "data:audio/mpeg;base64,TBD_TH_GOOD_MORNING_1_BASE64_AUDIO_HERE",
            "he_good_evening_1": "data:audio/mpeg;base64,TBD_HE_GOOD_EVENING_1_BASE64_AUDIO_HERE",
            "th_good_evening_1": "data:audio/mpeg;base64,TBD_TH_GOOD_EVENING_1_BASE64_AUDIO_HERE",
            "he_how_are_you_1": "data:audio/mpeg;base64,TBD_HE_HOW_ARE_YOU_1_BASE64_AUDIO_HERE",
            "th_how_are_you_1": "data:audio/mpeg;base64,TBD_TH_HOW_ARE_YOU_1_BASE64_AUDIO_HERE",
            "he_how_do_you_feel_1": "data:audio/mpeg;base64,TBD_HE_HOW_DO_YOU_FEEL_1_BASE64_AUDIO_HERE",
            "th_how_do_you_feel_1": "data:audio/mpeg;base64,TBD_TH_HOW_DO_YOU_FEEL_1_BASE64_AUDIO_HERE",
            "he_come_help_loading_1": "data:audio/mpeg;base64,TBD_HE_COME_HELP_LOADING_1_BASE64_AUDIO_HERE",
            "th_come_help_loading_1": "data:audio/mpeg;base64,TBD_TH_COME_HELP_LOADING_1_BASE64_AUDIO_HERE",
            "he_need_forklift_1": "data:audio/mpeg;base64,TBD_HE_NEED_FORKLIFT_1_BASE64_AUDIO_HERE",
            "th_need_forklift_1": "data:audio/mpeg;base64,TBD_TH_NEED_FORKLIFT_1_BASE64_AUDIO_HERE",
            "he_where_is_it_1": "data:audio/mpeg;base64,TBD_HE_WHERE_IS_IT_1_BASE64_AUDIO_HERE",
            "th_where_is_it_1": "data:audio/mpeg;base64,TBD_TH_WHERE_IS_IT_1_BASE64_AUDIO_HERE",
            "he_finished_work_1": "data:audio/mpeg;base64,TBD_HE_FINISHED_WORK_1_BASE64_AUDIO_HERE",
            "th_finished_work_1": "data:audio/mpeg;base64,TBD_TH_FINISHED_WORK_1_BASE64_AUDIO_HERE",
            "he_need_water_1": "data:audio/mpeg;base64,TBD_HE_NEED_WATER_1_BASE64_AUDIO_HERE",
            "th_need_water_1": "data:audio/mpeg;base64,TBD_TH_NEED_WATER_1_BASE64_AUDIO_HERE",
            "he_hungry_1": "data:audio/mpeg;base64,TBD_HE_HUNGRY_1_BASE64_AUDIO_HERE",
            "th_hungry_1": "data:audio/mpeg;base64,TBD_TH_HUNGRY_1_BASE64_AUDIO_HERE",
            "he_thank_you_1": "data:audio/mpeg;base64,TBD_HE_THANK_YOU_1_BASE64_AUDIO_HERE",
            "th_thank_you_1": "data:audio/mpeg;base64,TBD_TH_THANK_YOU_1_BASE64_AUDIO_HERE",
            "he_you_are_welcome_1": "data:audio/mpeg;base64,TBD_HE_YOU_ARE_WELCOME_1_BASE64_AUDIO_HERE",
            "th_you_are_welcome_1": "data:audio/mpeg;base64,TBD_TH_YOU_ARE_WELCOME_1_BASE64_AUDIO_HERE",
            "he_please_1": "data:audio/mpeg;base64,TBD_HE_PLEASE_1_BASE64_AUDIO_HERE",
            "th_please_1": "data:audio/mpeg;base64,TBD_TH_PLEASE_1_BASE64_AUDIO_HERE",
            "he_yes_1": "data:audio/mpeg;base64,TBD_HE_YES_1_BASE64_AUDIO_HERE",
            "th_yes_1": "data:audio/mpeg;base64,TBD_TH_YES_1_BASE64_AUDIO_HERE",
            "he_no_1": "data:audio/mpeg;base64,TBD_HE_NO_1_BASE64_AUDIO_HERE",
            "th_no_1": "data:audio/mpeg;base64,TBD_TH_NO_1_BASE64_AUDIO_HERE",
            "he_come_back_tomorrow_1": "data:audio/mpeg;base64,TBD_HE_COME_BACK_TOMORROW_1_BASE64_AUDIO_HERE",
            "th_come_back_tomorrow_1": "data:audio/mpeg;base64,TBD_TH_COME_BACK_TOMORROW_1_BASE64_AUDIO_HERE",
            "he_work_harder_1": "data:audio/mpeg;base64,TBD_HE_WORK_HARDER_1_BASE64_AUDIO_HERE",
            "th_work_harder_1": "data:audio/mpeg;base64,TBD_TH_WORK_HARDER_1_BASE64_AUDIO_HERE",
            "he_take_a_break_1": "data:audio/mpeg;base64,TBD_HE_TAKE_A_BREAK_1_BASE64_AUDIO_HERE",
            "th_take_a_break_1": "data:audio/mpeg;base64,TBD_TH_TAKE_A_BREAK_1_BASE64_AUDIO_HERE",
            "he_good_job_1": "data:audio/mpeg;base64,TBD_HE_GOOD_JOB_1_BASE64_AUDIO_HERE",
            "th_good_job_1": "data:audio/mpeg;base64,TBD_TH_GOOD_JOB_1_BASE64_AUDIO_HERE",
            "he_clean_this_1": "data:audio/mpeg;base64,TBD_HE_CLEAN_THIS_1_BASE64_AUDIO_HERE",
            "th_clean_this_1": "data:audio/mpeg;base64,TBD_TH_CLEAN_THIS_1_BASE64_AUDIO_HERE",
            "he_move_it_there_1": "data:audio/mpeg;base64,TBD_HE_MOVE_IT_THERE_1_BASE64_AUDIO_HERE",
            "th_move_it_there_1": "data:audio/mpeg;base64,TBD_TH_MOVE_IT_THERE_1_BASE64_AUDIO_HERE",
            "he_finish_loading_1": "data:audio/mpeg;base64,TBD_HE_FINISH_LOADING_1_BASE64_AUDIO_HERE",
            "th_finish_loading_1": "data:audio/mpeg;base64,TBD_TH_FINISH_LOADING_1_BASE64_AUDIO_HERE",
            "he_go_to_lunch_1": "data:audio/mpeg;base64,TBD_HE_GO_TO_LUNCH_1_BASE64_AUDIO_HERE",
            "th_go_to_lunch_1": "data:audio/mpeg;base64,TBD_TH_GO_TO_LUNCH_1_BASE64_AUDIO_HERE",
            "he_number_1": "data:audio/mpeg;base64,TBD_HE_NUMBER_1_BASE64_AUDIO_HERE",
            "th_number_1": "data:audio/mpeg;base64,TBD_TH_NUMBER_1_BASE64_AUDIO_HERE",
            "he_number_2": "data:audio/mpeg;base64,TBD_HE_NUMBER_2_BASE64_AUDIO_HERE",
            "th_number_2": "data:audio/mpeg;base664,TBD_TH_NUMBER_2_BASE64_AUDIO_HERE",
            "he_number_3": "data:audio/mpeg;base64,TBD_HE_NUMBER_3_BASE64_AUDIO_HERE",
            "th_number_3": "data:audio/mpeg;base64,TBD_TH_NUMBER_3_BASE64_AUDIO_HERE",
            "he_number_4": "data:audio/mpeg;base64,TBD_HE_NUMBER_4_BASE64_AUDIO_HERE",
            "th_number_4": "data:audio/mpeg;base64,TBD_TH_NUMBER_4_BASE64_AUDIO_HERE",
            "he_number_5": "data:audio/mpeg;base64,TBD_HE_NUMBER_5_BASE64_AUDIO_HERE",
            "th_number_5": "data:audio/mpeg;base64,TBD_TH_NUMBER_5_BASE64_AUDIO_HERE",
            "he_number_6": "data:audio/mpeg;base64,TBD_HE_NUMBER_6_BASE64_AUDIO_HERE",
            "th_number_6": "data:audio/mpeg;base64,TBD_TH_NUMBER_6_BASE64_AUDIO_HERE",
            "he_number_7": "data:audio/mpeg;base64,TBD_HE_NUMBER_7_BASE64_AUDIO_HERE",
            "th_number_7": "data:audio/mpeg;base64,TBD_TH_NUMBER_7_BASE64_AUDIO_HERE",
            "he_number_8": "data:audio/mpeg;base64,TBD_HE_NUMBER_8_BASE64_AUDIO_HERE",
            "th_number_8": "data:audio/mpeg;base64,TBD_TH_NUMBER_8_BASE64_AUDIO_HERE",
            "he_number_9": "data:audio/mpeg;base64,TBD_HE_NUMBER_9_BASE64_AUDIO_HERE",
            "th_number_9": "data:audio/mpeg;base64,TBD_TH_NUMBER_9_BASE64_AUDIO_HERE",
            "he_number_10": "data:audio/mpeg;base64,TBD_HE_NUMBER_10_BASE64_AUDIO_HERE",
            "th_number_10": "data:audio/mpeg;base64,TBD_TH_NUMBER_10_BASE64_AUDIO_HERE",
            "he_wait_a_minute": "data:audio/mpeg;base64,TBD_HE_WAIT_A_MINUTE_BASE64_AUDIO_HERE",
            "th_wait_a_minute": "data:audio/mpeg;base64,TBD_TH_WAIT_A_MINUTE_BASE64_AUDIO_HERE",
            "he_clean_floor": "data:audio/mpeg;base64,TBD_HE_CLEAN_FLOOR_BASE64_AUDIO_HERE",
            "th_clean_floor": "data:audio/mpeg;base64,TBD_TH_CLEAN_FLOOR_BASE64_AUDIO_HERE",
            "he_come_here_now": "data:audio/mpeg;base64,TBD_HE_COME_HERE_NOW_BASE64_AUDIO_HERE",
            "th_come_here_now": "data:audio/mpeg;base64,TBD_TH_COME_HERE_NOW_BASE64_AUDIO_HERE",
            "he_start_working": "data:audio/mpeg;base64,TBD_HE_START_WORKING_BASE64_AUDIO_HERE",
            "th_start_working": "data:audio/mpeg;base64,TBD_TH_START_WORKING_BASE64_AUDIO_HERE",
            "he_customer_is_waiting": "data:audio/mpeg;base64,TBD_HE_CUSTOMER_IS_WAITING_BASE64_AUDIO_HERE",
            "th_customer_is_waiting": "data:audio/mpeg;base64,TBD_TH_CUSTOMER_IS_WAITING_BASE64_AUDIO_HERE"
        };


        // מאגר המשפטים הראשי עבור כפתורי הפאנלים
        const phrasesData = [
            // בקשות עובד תאילנדי (בקשות למנהל)
            { "id": "thai_break_request_1", "display_text": "הפסקה", "icon": "☕", "he_text": "אני רוצה הפסקה.", "th_text": "ผม/ฉัน ขอพัก", "he_audio_id": "he_break_1", "th_audio_id": "th_break_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_toilet_request_1", "display_text": "שירותים", "icon": "🚽", "he_text": "אני צריך לשירותים.", "th_text": "ผม/ฉัน ต้องการไปห้องน้ำ", "he_audio_id": "he_toilet_1", "th_audio_id": "th_toilet_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_help_request_1", "display_text": "עזרה דחוף", "icon": "✋", "he_text": "אני צריך עזרה עכשיו!", "th_text": "ผม/ฉัน ต้องการความช่วยเหลือเดี๋ยวนี้!", "he_audio_id": "he_help_1", "th_audio_id": "th_help_1", "panel": "thai_worker", "is_urgent": true },
            { "id": "thai_sick_request_1", "display_text": "מרגיש חולה", "icon": "😷", "he_text": "אני מרגיש חולה.", "th_text": "ผม/ฉัน รู้สึกไม่สบาย", "he_audio_id": "he_sick_1", "th_audio_id": "th_sick_1", "panel": "thai_worker", "is_urgent": true },
            { "id": "thai_good_morning_1", "display_text": "בוקר טוב", "icon": "☀️", "he_text": "בוקר טוב.", "th_text": "สวัสดีตอนเช้า", "he_audio_id": "he_good_morning_1", "th_audio_id": "th_good_morning_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_good_evening_1", "display_text": "ערב טוב", "icon": "🌙", "he_text": "ערב טוב.", "th_text": "สวัสดีตอนเย็น", "he_audio_id": "he_good_evening_1", "th_audio_id": "th_good_evening_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_how_are_you_1", "display_text": "מה שלומך?", "icon": "😊", "he_text": "מה שלומך?", "th_text": "สบายดีไหม?", "he_audio_id": "he_how_are_you_1", "th_audio_id": "th_how_are_you_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_how_do_you_feel_1", "display_text": "איך מרגיש?", "icon": "�", "he_text": "איך אתה מרגיש?", "th_text": "คุณรู้สึกอย่างไร?", "he_audio_id": "he_how_do_you_feel_1", "th_audio_id": "th_how_do_you_feel_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_need_forklift_1", "display_text": "צריך מלגזה", "icon": " forklift", "he_text": "אני צריך מלגזה.", "th_text": "ผม/ฉัน ต้องการรถยก", "he_audio_id": "he_need_forklift_1", "th_audio_id": "th_need_forklift_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_where_is_it_1", "display_text": "איפה זה?", "icon": "❓", "he_text": "איפה זה?", "th_text": "มันอยู่ที่ไหน?", "he_audio_id": "he_where_is_it_1", "th_audio_id": "th_where_is_it_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_finished_work_1", "display_text": "סיימתי עבודה", "icon": "✅", "he_text": "סיימתי את העבודה.", "th_text": "ผม/ฉัน ทำงานเสร็จแล้ว", "he_audio_id": "he_finished_work_1", "th_audio_id": "th_finished_work_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_need_water_1", "display_text": "צריך מים", "icon": "💧", "he_text": "אני צריך מים.", "th_text": "ผม/ฉัน ต้องการน้ำ", "he_audio_id": "he_need_water_1", "th_audio_id": "th_need_water_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_hungry_1", "display_text": "אני רעב", "icon": "🍔", "he_text": "אני רעב.", "th_text": "ผม/ฉัน หิว", "he_audio_id": "he_hungry_1", "th_audio_id": "th_hungry_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_thank_you_1", "display_text": "תודה", "icon": "🙏", "he_text": "תודה.", "th_text": "ขอบคุณ", "he_audio_id": "he_thank_you_1", "th_audio_id": "th_thank_you_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_you_are_welcome_1", "display_text": "בבקשה", "icon": "😊", "he_text": "בבקשה.", "th_text": "ยินดี", "he_audio_id": "he_you_are_welcome_1", "th_audio_id": "th_you_are_welcome_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_yes_1", "display_text": "כן", "icon": "👍", "he_text": "כן.", "th_text": "ใช่", "he_audio_id": "he_yes_1", "th_audio_id": "th_yes_1", "panel": "thai_worker", "is_urgent": false },
            { "id": "thai_no_1", "display_text": "לא", "icon": "👎", "he_text": "לא.", "th_text": "ไม่", "he_audio_id": "he_no_1", "th_audio_id": "th_no_1", "panel": "thai_worker", "is_urgent": false },

            // הוראות מנהל (הוראות לעובד)
            { "id": "manager_load_cement_1", "display_text": "העמס מלט", "icon": "📦", "he_text": "תעמיס מלט.", "th_text": "ขนปูน", "he_audio_id": "he_load_cement_1", "th_audio_id": "th_load_cement_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_organize_area_1", "display_text": "סדר אזור", "icon": "🧹", "he_text": "תבוא תסדר את האזור הזה.", "th_text": "มาจัดระเบียบพื้นที่นี้หน่อย", "he_audio_id": "he_organize_area_1", "th_audio_id": "th_organize_area_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_clean_table_1", "display_text": "נקה שולחן", "icon": "🧼", "he_text": "תנקה את השולחן.", "th_text": "ทำความสะอาดโต๊ะ", "he_audio_id": "he_clean_table_1", "th_audio_id": "th_clean_table_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_finish_now_1", "display_text": "סיים עכשיו", "icon": "⏱️", "he_text": "תסיים את העבודה עכשיו.", "th_text": "ทำงานให้เสร็จเดี๋ยวนี้", "he_audio_id": "he_finish_now_1", "th_audio_id": "th_finish_now_1", "panel": "manager", "is_urgent": true },
            { "id": "manager_come_here_1", "display_text": "בוא לכאן", "icon": "🚶‍♂️", "he_text": "בוא לכאן בבקשה.", "th_text": "มานี่หน่อยครับ/ค่ะ", "he_audio_id": "he_come_here_1", "th_audio_id": "th_come_here_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_load_bags_1", "display_text": "העמס שקים", "icon": "🛍️", "he_text": "תעמיס את השקים.", "th_text": "ขนกระสอบ", "he_audio_id": "he_load_bags_1", "th_audio_id": "th_load_bags_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_help_alaa_1", "display_text": "עזור לעלאא", "icon": "🤝", "he_text": "תעזור לעלאא.", "th_text": "ช่วยอะลาอ์หน่อย", "he_audio_id": "he_help_alaa_1", "th_audio_id": "th_help_alaa_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_help_adham_1", "display_text": "עזור לאדהם", "icon": "🤝", "he_text": "תעזור לאדהם.", "th_text": "ช่วยอาดามหน่อย", "he_audio_id": "he_help_adham_1", "th_audio_id": "th_help_adham_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_help_store_1", "display_text": "עזור למחסן", "icon": "🛒", "he_text": "תעזור למחסן.", "th_text": "ช่วยคลังสินค้าหน่อย", "he_audio_id": "he_help_store_1", "th_audio_id": "th_help_store_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_next_product_1", "display_text": "מוצר הבא", "icon": "➡️", "he_text": "תביא את המוצר הבא.", "th_text": "เอาสินค้าชิ้นต่อไปมา", "he_audio_id": "he_next_product_1", "th_audio_id": "th_next_product_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_come_help_loading_1", "display_text": "בוא עזור להעמיס", "icon": "💪", "he_text": "בוא תעזור להעמיס.", "th_text": "มาช่วยขนของหน่อย", "he_audio_id": "he_come_help_loading_1", "th_audio_id": "th_come_help_loading_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_come_back_tomorrow_1", "display_text": "תחזור מחר", "icon": "🗓️", "he_text": "תחזור מחר לעבודה.", "th_text": "กลับมาทำงานพรุ่งนี้", "he_audio_id": "he_come_back_tomorrow_1", "th_audio_id": "th_come_back_tomorrow_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_work_harder_1", "display_text": "תעבוד יותר חזק", "icon": "⚡", "he_text": "תעבוד יותר חזק.", "th_text": "ทำงานให้หนักขึ้น", "he_audio_id": "he_work_harder_1", "th_audio_id": "th_work_harder_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_take_a_break_1", "display_text": "צא להפסקה", "icon": "☕", "he_text": "צא להפסקה.", "th_text": "ไปพักได้", "he_audio_id": "he_take_a_break_1", "th_audio_id": "th_take_a_break_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_good_job_1", "display_text": "עבודה טובה", "icon": "⭐", "he_text": "עבודה טובה!", "th_text": "งานดี", "he_audio_id": "he_good_job_1", "th_audio_id": "th_good_job_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_clean_this_1", "display_text": "נקה את זה", "icon": "🧼", "he_text": "תנקה את זה.", "th_text": "ทำความสะอาดอันนี้", "he_audio_id": "he_clean_this_1", "th_audio_id": "th_clean_this_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_move_it_there_1", "display_text": "הזז לשם", "icon": "🚚", "he_text": "תזיז את זה לשם.", "th_text": "ย้ายไปตรงนั้น", "he_audio_id": "he_move_it_there_1", "th_audio_id": "th_move_it_there_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_finish_loading_1", "display_text": "סיים להעמיס", "icon": "✅", "he_text": "תסיים להעמיס.", "th_text": "ขนของเสร็จ", "he_audio_id": "he_finish_loading_1", "th_audio_id": "th_finish_loading_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_go_to_lunch_1", "display_text": "לך לאכול", "icon": "🍲", "he_text": "לך לאכול צהריים.", "th_text": "ไปกินข้าวกลางวัน", "he_audio_id": "he_go_to_lunch_1", "th_audio_id": "th_go_to_lunch_1", "panel": "manager", "is_urgent": false },
            { "id": "manager_wait_a_minute_1", "display_text": "חכה דקה", "icon": "⏳", "he_text": "חכה דקה.", "th_text": "รอสักครู่", "he_audio_id": "he_wait_a_minute", "th_audio_id": "th_wait_a_minute", "panel": "manager", "is_urgent": false },
            { "id": "manager_clean_floor_1", "display_text": "נקה רצפה", "icon": "🧹", "he_text": "תנקה את הרצפה.", "th_text": "ทำความสะอาดพื้น", "he_audio_id": "he_clean_floor", "th_audio_id": "th_clean_floor", "panel": "manager", "is_urgent": false },
            { "id": "manager_come_here_now_1", "display_text": "בוא לכאן עכשיו", "icon": "🚨", "he_text": "בוא לכאן עכשיו!", "th_text": "มานี่เดี๋ยวนี้!", "he_audio_id": "he_come_here_now", "th_audio_id": "th_come_here_now", "panel": "manager", "is_urgent": true },
            { "id": "manager_start_working_1", "display_text": "תתחיל לעבוד", "icon": "▶️", "he_text": "תתחיל לעבוד.", "th_text": "เริ่มทำงาน", "he_audio_id": "he_start_working", "th_audio_id": "th_start_working", "panel": "manager", "is_urgent": false },
            { "id": "manager_customer_is_waiting_1", "display_text": "לקוח מחכה", "icon": "🧍", "he_text": "לקוח מחכה.", "th_text": "ลูกค้ารออยู่", "he_audio_id": "he_customer_is_waiting", "th_audio_id": "th_customer_is_waiting", "panel": "manager", "is_urgent": false }
        ];

        // מאגר למשפטים מיידיים ומספרים
        const instantPhrases = [
            { "text": "בוקר טוב", "thai": "สวัสดีตอนเช้า", "he_audio_id": "he_good_morning_1", "th_audio_id": "th_good_morning_1" },
            { "text": "ערב טוב", "thai": "สวัสดีตอนเย็น", "he_audio_id": "he_good_evening_1", "th_audio_id": "th_good_evening_1" },
            { "text": "מה שלומך?", "thai": "สบายดีไหม?", "he_audio_id": "he_how_are_you_1", "th_audio_id": "th_how_are_you_1" },
            { "text": "איך אתה מרגיש?", "thai": "คุณรู้สึกอย่างไร?", "he_audio_id": "he_how_do_you_feel_1", "th_audio_id": "th_how_do_you_feel_1" },
            { "text": "אני רוצה הפסקה.", "thai": "ผม/ฉัน ขอพัก", "he_audio_id": "he_break_1", "th_audio_id": "th_break_1" },
            { "text": "אני צריך לשירותים.", "thai": "ผม/ฉัน ต้องการไปห้องน้ำ", "he_audio_id": "he_toilet_1", "th_audio_id": "th_toilet_1" },
            { "text": "אני צריך עזרה עכשיו!", "thai": "ผม/ฉัน ต้องการความช่วยเหลือเดี๋ยวนี้!", "he_audio_id": "he_help_1", "th_audio_id": "th_help_1" },
            { "text": "אני מרגיש חולה.", "thai": "ผม/ฉัน รู้สึกไม่สบาย", "he_audio_id": "he_sick_1", "th_audio_id": "th_sick_1" },
            { "text": "תודה.", "thai": "ขอบคุณ", "he_audio_id": "he_thank_you_1", "th_audio_id": "th_thank_you_1" },
            { "text": "בבקשה.", "thai": "ยินดี", "he_audio_id": "he_you_are_welcome_1", "th_audio_id": "th_you_are_welcome_1" },
            { "text": "כן.", "thai": "ใช่", "he_audio_id": "he_yes_1", "th_audio_id": "th_yes_1" },
            { "text": "לא.", "thai": "ไม่", "he_audio_id": "he_no_1", "th_audio_id": "th_no_1" }
        ];

        const numberPhrases = [];
        for (let i = 1; i <= 10; i++) {
            numberPhrases.push({
                "text": i.toString(),
                "thai": getThaiNumber(i),
                "he_audio_id": `he_number_${i}`,
                "th_audio_id": `th_number_${i}`
            });
        }

        function getThaiNumber(num) {
            const thaiNumbers = ["", "หนึ่ง", "สอง", "สาม", "สี่", "ห้า", "หก", "เจ็ด", "แปด", "เก้า", "สิบ"];
            return thaiNumbers[num];
        }


        /**
         * מנגן צליל פעמון קצר.
         */
        function playBellSound() {
            if (bellSound) {
                bellSound.currentTime = 0; // התחל מההתחלה
                bellSound.play().catch(e => console.error("שגיאה בניגון צלצול פעמון:", e));
            }
        }

        /**
         * מציג פופאפ עם טקסט ואודיו.
         * @param {string} text - הטקסט להצגה בפופאפ.
         * @param {string} audioUrl - ה-URL של קובץ האודיו לניגון.
         * @param {boolean} isUrgent - האם ההודעה דחופה (תפעיל אנימציה ואייקון).
         */
        function showPopup(text, audioUrl, isUrgent = false) {
            clearTimeout(popupCloseTimeout); // נקה כל טיימר קודם של סגירה אוטומטית

            popupText.textContent = text;
            popupAudioUrl = audioUrl;

            // עדכן אנימציה וסגנון
            popupContent.classList.remove('urgent-popup-animate', 'popup-animate');
            urgentIcon.classList.add('hidden'); // הסתר אייקון כברירת מחדל

            if (isUrgent) {
                popupContent.classList.add('urgent-popup-animate');
                urgentIcon.classList.remove('hidden');
                playBellSound(); // נגן צלצול פעמון להודעות דחופות
            } else {
                popupContent.classList.add('popup-animate');
            }

            popupOverlay.classList.remove('hidden');
            // הפעל אנימציית כניסה
            setTimeout(() => {
                popupContent.classList.remove('scale-0', 'opacity-0');
                popupContent.classList.add('scale-100', 'opacity-100');
            }, 10); // השהיה קצרה להפעלת אנימציה

            playAudio(audioUrl);

            // סגור פופאפ אוטומטית לאחר 5 שניות אם זו לא הודעה דחופה
            if (!isUrgent) {
                popupCloseTimeout = setTimeout(() => {
                    hidePopup();
                }, 5000);
            }
        }

        /**
         * מסתיר את הפופאפ.
         */
        function hidePopup() {
            clearTimeout(popupCloseTimeout); // נקה את הטיימר
            popupContent.classList.remove('scale-100', 'opacity-100');
            popupContent.classList.add('scale-0', 'opacity-0');
            // הסתר את האוברליי לאחר שהאנימציה הסתיימה
            popupContent.addEventListener('transitionend', () => {
                popupOverlay.classList.add('hidden');
                // הסר את מאזין האירועים כדי למנוע הדלפות זיכרון
                popupContent.removeEventListener('transitionend', arguments.callee);
            }, { once: true });
        }

        /**
         * מנגן קובץ אודיו מ-URL.
         * @param {string} audioUrl - ה-URL של קובץ האודיו.
         */
        function playAudio(audioUrl) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.removeAttribute('src'); // הסר את ה-src כדי לטעון מחדש
                currentAudio.load();
            } else {
                currentAudio = new Audio();
            }
            currentAudio.src = audioUrl;
            currentAudio.play().catch(e => console.error("שגיאה בניגון אודיו:", e));
        }

        /**
         * מציג טקסט באפקט הקלדה על המסך הראשי.
         * @param {string} text - הטקסט להצגה.
         * @param {string} lang - השפה של הטקסט ('he' או 'th').
         * @param {string} audioUrl - ה-URL של האודיו לניגון.
         */
        function typeWriterEffect(text, lang, audioUrl) {
            mainDisplayText.textContent = ''; // נקה טקסט קיים
            mainDisplayText.classList.remove('thai-text'); // הסר סגנון תאית אם קיים
            mainDisplayText.classList.add('typing-effect'); // הוסף סמן הקלדה

            if (lang === 'th') {
                mainDisplayText.classList.add('thai-text');
            }

            let i = 0;
            const speed = 70; // מהירות הקלדה במילישניות

            function type() {
                if (i < text.length) {
                    mainDisplayText.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    mainDisplayText.classList.remove('typing-effect'); // הסר סמן הקלדה בסיום
                    // נגן אודיו רק לאחר סיום הקלדה
                    if (audioUrl) {
                        playAudio(audioUrl);
                    }
                }
            }
            type();
        }

        /**
         * פונקציה ליצירת כפתור והוספתו לפאנל.
         * @param {object} phrase - אובייקט המכיל את פרטי המשפט (display_text, he_text, th_text, icon, he_audio_id, th_audio_id, is_urgent).
         * @param {HTMLElement} panelElement - אלמנט ה-HTML (div) שאליו יש להוסיף את הכפתור.
         * @param {string} type - 'thai_to_he' או 'he_to_thai'.
         */
        function createButton(phrase, panelElement, type) {
            const button = document.createElement('button');
            button.className = `p-4 flex flex-col items-center justify-center bg-white rounded-xl shadow-md hover:shadow-lg transition-all transform hover:scale-105
                                 text-xl font-semibold text-gray-800 border-2 border-transparent relative overflow-hidden h-32 text-center`; // הגדל גובה הכפתורים

            if (phrase.is_urgent) {
                button.classList.add('bg-red-500', 'text-white', 'hover:bg-red-600', 'border-red-700');
                const urgencyIndicator = document.createElement('span');
                urgencyIndicator.className = 'absolute top-2 left-2 text-3xl opacity-80';
                urgencyIndicator.textContent = '❗'; // אייקון דחיפות
                button.appendChild(urgencyIndicator);
            } else {
                button.classList.add('bg-blue-200', 'hover:bg-blue-300');
            }

            // הוסף אייקון
            if (phrase.icon) {
                const iconSpan = document.createElement('span');
                iconSpan.className = 'text-4xl mb-1'; // גודל אייקון גדול יותר
                iconSpan.textContent = phrase.icon;
                button.appendChild(iconSpan);
            }

            const textSpan = document.createElement('span');
            textSpan.textContent = phrase.display_text;
            button.appendChild(textSpan);

            // הוסף אירוע לחיצה לכפתור
            button.addEventListener('click', () => {
                let textToDisplay = '';
                let audioToPlayId = '';
                let spokenLanguage = '';
                let translatedText = '';

                if (panelElement.id === 'thaiWorkerPanel') { // עובד תאילנדי (מדבר תאית)
                    textToDisplay = phrase.th_text;
                    audioToPlayId = phrase.th_audio_id;
                    spokenLanguage = 'th';
                    translatedText = phrase.he_text; // התרגום לעברית יוצג בפופאפ
                } else if (panelElement.id === 'managerPanel') { // מנהל (מדבר עברית)
                    textToDisplay = phrase.he_text;
                    audioToPlayId = phrase.he_audio_id;
                    spokenLanguage = 'he';
                    translatedText = phrase.th_text; // התרגום לתאית יוצג בפופאפ
                } else if (panelElement.id === 'instantPhrasesHe' || panelElement.id === 'numberPhrasesHe') {
                    textToDisplay = phrase.text; // עברית
                    audioToPlayId = phrase.he_audio_id;
                    spokenLanguage = 'he';
                    translatedText = phrase.thai; // תרגום לתאית
                } else if (panelElement.id === 'instantPhrasesTh' || panelElement.id === 'numberPhrasesTh') {
                    textToDisplay = phrase.text; // תאית
                    audioToPlayId = phrase.th_audio_id;
                    spokenLanguage = 'th';
                    translatedText = phrase.he_text; // תרגום לעברית
                }

                // הפעל אפקט הקלדה על המסך הראשי
                typeWriterEffect(textToDisplay, spokenLanguage, base64AudioData[audioToPlayId]);

                // הצג את הפופאפ עם הטקסט המתורגם
                // קבע את שפת הטקסט המתורגם בפופאפ
                const popupTranslatedLang = (spokenLanguage === 'he' || panelElement.id === 'instantPhrasesHe' || panelElement.id === 'numberPhrasesHe') ? 'th' : 'he';
                showPopup(translatedText, (popupTranslatedLang === 'th' ? base64AudioData[phrase.th_audio_id] : base64AudioData[phrase.he_audio_id]), phrase.is_urgent);

                // נגן צלצול פעמון על כל לחיצת כפתור (אם לא דחוף, זה יהיה בנוסף לצלצול הדחוף)
                if (!phrase.is_urgent) { // נגן רק אם לא נגן כבר ב-showPopup
                    playBellSound();
                }
            });

            panelElement.appendChild(button);
        }

        // פונקציות לאכלוס הכפתורים בפאנלים השונים
        function populatePanels() {
            const thaiWorkerPanel = document.getElementById('thaiWorkerPanel');
            const managerPanel = document.getElementById('managerPanel');
            const instantPhrasesHe = document.getElementById('instantPhrasesHe');
            const instantPhrasesTh = document.getElementById('instantPhrasesTh');
            const numberPhrasesHe = document.getElementById('numberPhrasesHe');
            const numberPhrasesTh = document.getElementById('numberPhrasesTh');


            phrasesData.forEach(phrase => {
                if (phrase.panel === 'thai_worker') {
                    createButton(phrase, thaiWorkerPanel, 'thai_to_he');
                } else if (phrase.panel === 'manager') {
                    createButton(phrase, managerPanel, 'he_to_thai');
                }
            });

            instantPhrases.forEach(phrase => {
                createButton({
                    display_text: phrase.text,
                    icon: '💬',
                    he_text: phrase.text,
                    th_text: phrase.thai,
                    he_audio_id: phrase.he_audio_id,
                    th_audio_id: phrase.th_audio_id,
                    is_urgent: false // משפטים מיידיים בדרך כלל אינם דחופים
                }, instantPhrasesHe, 'he_to_thai');

                createButton({
                    display_text: phrase.thai,
                    icon: '💬',
                    he_text: phrase.he_text, // עבור הצגה בפופאפ
                    th_text: phrase.thai,
                    he_audio_id: phrase.he_audio_id,
                    th_audio_id: phrase.th_audio_id,
                    is_urgent: false
                }, instantPhrasesTh, 'thai_to_he');
            });

            numberPhrases.forEach(phrase => {
                createButton({
                    display_text: phrase.text,
                    icon: '#️⃣',
                    he_text: phrase.text,
                    th_text: phrase.thai,
                    he_audio_id: phrase.he_audio_id,
                    th_audio_id: phrase.th_audio_id,
                    is_urgent: false
                }, numberPhrasesHe, 'he_to_thai');

                createButton({
                    display_text: phrase.thai,
                    icon: '#️⃣',
                    he_text: phrase.he_text, // עבור הצגה בפופאפ
                    th_text: phrase.thai,
                    he_audio_id: phrase.he_audio_id,
                    th_audio_id: phrase.th_audio_id,
                    is_urgent: false
                }, numberPhrasesTh, 'thai_to_he');
            });
        }


        // אירועי פופאפ
        popupCloseButton.addEventListener('click', hidePopup);
        popupReplayButton.addEventListener('click', () => {
            if (popupAudioUrl) {
                playAudio(popupAudioUrl);
            }
        });

        // אתחול מקלדת וירטואלית
        function initKeyboard() {
            keyboard = new SimpleKeyboard.default({
                onChange: input => {
                    document.getElementById('freeTextInput').value = input;
                    // כאשר המשתמש מקליד, נקה את המסך הראשי של התרגום המיידי
                    mainDisplayText.textContent = '';
                    mainDisplayText.classList.remove('thai-text', 'typing-effect');
                },
                onKeyPress: button => {
                    if (button === "{shift}" || button === "{capslock}") {
                        handleShiftAndCaps();
                    }
                },
                layout: layoutOptions[currentKeyboardLayout],
                theme: "hg-theme-default hg-layout-numeric simple-keyboard", // הוסף קלאס להתאמה אישית
                display: {
                    '{bksp}': 'מחק',
                    '{tab}': 'טאב',
                    '{capslock}': 'קאפס',
                    '{shift}': 'שיפט',
                    '{space}': 'רווח'
                }
            });
        }

        function handleShiftAndCaps() {
            let currentLayout = keyboard.options.layoutName;
            let newLayout = currentLayout === "default" ? "shift" : "default";
            keyboard.setOptions({
                layoutName: newLayout
            });
        }

        // שינוי פריסת מקלדת
        document.getElementById('setLangHe').addEventListener('click', () => {
            currentKeyboardLayout = 'hebrew';
            keyboard.setOptions({ layout: layoutOptions.hebrew, rtl: true });
            keyboard.setInput('');
            document.getElementById('freeTextInput').classList.remove('thai-text');
            document.getElementById('freeTextInput').style.direction = 'rtl';
        });

        document.getElementById('setLangTh').addEventListener('click', () => {
            currentKeyboardLayout = 'thai';
            keyboard.setOptions({ layout: layoutOptions.thai, rtl: false });
            keyboard.setInput('');
            document.getElementById('freeTextInput').classList.add('thai-text');
            document.getElementById('freeTextInput').style.direction = 'ltr';
        });

        // תרגום טקסט חופשי (מודל ג'מיני)
        document.getElementById('speakTranslated').addEventListener('click', async () => {
            const freeTextInput = document.getElementById('freeTextInput').value.trim();
            if (!freeTextInput) {
                showPopup("אנא הזן טקסט לתרגום.", "", false); // אין אודיו, לא דחוף
                return;
            }

            // הוסף אנימציית 'קשת בענן' למסך התרגום בזמן הטעינה
            mainTranslationDisplay.classList.add('rainbow-border');
            mainDisplayText.textContent = 'מתרגם...';
            mainDisplayText.classList.remove('thai-text'); // וודא שהפונט נורמלי בזמן טעינה
            mainDisplayText.style.direction = 'rtl'; // כיוון טקסט ל-RTL בזמן טעינה

            try {
                // קביעת שפת המקור והיעד לתרגום
                let sourceLang = '';
                let targetLang = '';
                if (currentKeyboardLayout === 'hebrew') {
                    sourceLang = 'he';
                    targetLang = 'th';
                } else {
                    sourceLang = 'th';
                    targetLang = 'he';
                }

                const prompt = `Translate the following text from ${sourceLang} to ${targetLang}: "${freeTextInput}"`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // If you want to use models other than gemini-2.0-flash or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                let translatedText = '';
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    translatedText = result.candidates[0].content.parts[0].text;
                } else {
                    translatedText = "שגיאה בתרגום. אנא נסה שוב.";
                }

                // עבור Gemini, יצירת TTS דורשת קריאה נוספת.
                // מכיוון שאין TTS מובנה, נציג את הטקסט המתורגם.
                // כאן היית משלב שירות TTS אם היה זמין, ומקבל Audio Base64.
                // כרגע, פשוט נציג את הטקסט המתורגם.

                mainDisplayText.classList.remove('rainbow-border'); // הסר את אנימציית הטעינה
                typeWriterEffect(translatedText, targetLang); // הצג את התרגום באפקט הקלדה

                // הדגמת ניגון אודיו אם היה זליל TTS
                // playAudio('data:audio/mpeg;base64,YOUR_GENERATED_TTS_AUDIO_BASE64_HERE');

            } catch (error) {
                console.error("שגיאה בתרגום:", error);
                mainDisplayText.textContent = "אירעה שגיאה בתרגום. אנא נסה שוב.";
                mainDisplayText.classList.remove('rainbow-border', 'thai-text');
                mainDisplayText.style.direction = 'rtl';
            }
        });


        // אתחול האפליקציה לאחר טעינת הדף
        window.onload = () => {
            populatePanels();
            initKeyboard();
            document.getElementById('freeTextInput').style.direction = 'rtl'; // ברירת מחדל עברית

            // הגדר את טקסט הפתיחה למסך הראשי
            mainDisplayText.textContent = 'ברוך הבא! בחר משפט או הקלד לתרגום.';
            // הסר את אנימציית הקלדה מטקסט הפתיחה
            mainDisplayText.classList.remove('typing-effect');
        };
    </script>
</body>
</html>
�
