<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××ª×•×¨×’××Ÿ ×—×›× - ×¢×•×‘×“-×× ×”×œ</title>

    <!-- Tailwind CSS CDN - ××©××© ×œ×¢×™×¦×•×‘ ××”×™×¨ ×•××•×“×¨× ×™ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ×¤×•× ×˜ Heebo ××ª××™× ×œ×¢×‘×¨×™×ª ×•×œ××¨××” × ×§×™ */
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');
        /* ×¤×•× ×˜ ×œ×ª××™×ª */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');
    </style>

    <!-- simple-keyboard CSS CDN - ×¢×‘×•×¨ ×”××§×œ×“×ª ×”×•×•×™×¨×˜×•××œ×™×ª -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.css">

    <style>
        /* ×”×’×“×¨×•×ª ×¤×•× ×˜ ×•×¨×™×¡×˜ ×›×œ×œ×™×•×ª ×œ×’×•×£ ×”×“×£ */
        body {
            font-family: 'Heebo', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            /* ×¨×§×¢ ×›×—×•×œ-×œ×‘×Ÿ ×¢× ×”×“×¨×’×ª×™×•×ª */
            background: linear-gradient(135deg, #e0f2fe 0%, #bbdefb 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px; /* ×”×’×“×œ ×¤×“×™× ×’ ×›×œ×œ×™ */
            gap: 32px; /* ××¨×•×•×— ×’×“×•×œ ×™×•×ª×¨ ×‘×™×Ÿ ×¡×§×©× ×™× */
        }

        /* ×”×¡×ª×¨×ª × ×’×Ÿ ×”××•×“×™×• ×”××•×‘× ×” ×©×œ ×”×“×¤×“×¤×Ÿ */
        audio {
            display: none;
        }

        /* ×¢×™×¦×•×‘ ×–×›×•×›×™×ª (Glassmorphism) ×œ×¤×× ×œ×™× ×•×œ×—×œ×§ ××”×›×¤×ª×•×¨×™× */
        .glass-panel {
            background-color: rgba(255, 255, 255, 0.6); /* ×¨×§×¢ ×œ×‘×Ÿ ×©×§×•×£ */
            backdrop-filter: blur(10px); /* ××¤×§×˜ ×˜×©×˜×•×© */
            border: 1px solid rgba(255, 255, 255, 0.3); /* ×’×‘×•×œ ×©×§×•×£ */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); /* ×¦×œ ×¢×“×™×Ÿ */
            border-radius: 20px; /* ×¤×™× ×•×ª ×¢×’×•×œ×•×ª ×™×•×ª×¨ */
        }

        /* ×”×’×“×¨×•×ª ×‘×¡×™×¡×™×•×ª ×©×œ simple-keyboard ×›×“×™ ×œ×”×ª××™× ×œ×¢×™×¦×•×‘ ×”×›×œ×œ×™ ×©×œ Tailwind */
        .simple-keyboard {
            @apply glass-panel p-6 max-w-4xl mx-auto;
        }
        .simple-keyboard .hg-button {
            @apply rounded-xl text-lg font-medium text-gray-800 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 transition-all duration-150;
            padding: 0.8rem 0.5rem;
        }
        .simple-keyboard .hg-button.hg-standardBtn {
            @apply h-14;
        }
        .simple-keyboard .hg-button.hg-functionBtn {
            @apply bg-blue-500 text-white hover:bg-blue-600;
        }
        .simple-keyboard .hg-button.hg-button-space {
            @apply w-full;
        }
        .simple-keyboard .hg-button-shift,
        .simple-keyboard .hg-button-capslock,
        .simple-keyboard .hg-button-tab,
        .simple-keyboard .hg-button-bksp {
            @apply bg-gray-300 text-gray-800 hover:bg-gray-400;
        }
        .simple-keyboard .hg-button-shift:active,
        .simple-keyboard .hg-button-capslock:active {
            @apply bg-gray-500;
        }
        .simple-keyboard .hg-row .hg-button {
            line-height: normal;
        }

        /* ×× ×™××¦×™×™×ª ×”×‘×”×•×‘ ×¢×‘×•×¨ ×”×¤×•×¤××¤ - ××•×©×š ×ª×©×•××ª ×œ×‘ */
        @keyframes pulse-once {
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 rgba(0, 0, 0, 0); }
            50% { transform: scale(1.02); opacity: 1; box-shadow: 0 0 20px rgba(0, 0, 0, 0.4); }
            100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 rgba(0, 0, 0, 0); }
        }

        @keyframes urgent-pulse {
            0% { background-color: rgba(255, 99, 71, 0.7); box-shadow: 0 0 15px rgba(255, 99, 71, 0.8); }
            50% { background-color: rgba(255, 140, 0, 0.7); box-shadow: 0 0 30px rgba(255, 140, 0, 0.8); }
            100% { background-color: rgba(255, 99, 71, 0.7); box-shadow: 0 0 15px rgba(255, 99, 71, 0.8); }
        }

        .popup-animate {
            animation: pulse-once 1.5s ease-out forwards;
        }
        .urgent-popup-animate {
            animation: urgent-pulse 1s infinite alternate; /* ×× ×™××¦×™×” ××ª×—×œ×¤×ª ×•××’×¨×¡×™×‘×™×ª ×™×•×ª×¨ */
        }

        /* ×× ×™××¦×™×™×ª ×‘×¨×§ ×•×§×©×ª ×¦×‘×¢×™× ×œ××©×¤×˜ ××ª×•×¨×’× ××™×™×“×™ */
        @keyframes rainbow-glow {
            0% { border-color: #ff0000; box-shadow: 0 0 15px #ff0000; }
            16% { border-color: #ff7f00; box-shadow: 0 0 15px #ff7f00; }
            33% { border-color: #ffff00; box-shadow: 0 0 15px #ffff00; }
            50% { border-color: #00ff00; box-shadow: 0 0 15px #00ff00; }
            66% { border-color: #0000ff; box-shadow: 0 0 15px #0000ff; }
            83% { border-color: #4b0082; box-shadow: 0 0 15px #4b0082; }
            100% { border-color: #9400d3; box-shadow: 0 0 15px #9400d3; }
        }

        .rainbow-border {
            border: 4px solid; /* ×¢×‘×” ×™×•×ª×¨ ×‘×©×‘×™×œ ×”××¤×§×˜ */
            animation: rainbow-glow 3s infinite alternate; /* ×× ×™××¦×™×” ××™× ×¡×•×¤×™×ª ×•××ª×—×œ×¤×ª */
        }
        
        /* ××¤×§×˜ ×”×§×œ×“×” */
        .typing-effect::after {
            content: '|';
            animation: blink-caret .75s step-end infinite;
        }

        @keyframes blink-caret {
            from, to { border-right-color: transparent }
            50% { border-right-color: black; }
        }

        /* ×¤×•× ×˜ ×¢×‘×•×¨ ×˜×§×¡×˜ ×ª××™×ª */
        .thai-text {
            font-family: 'Noto Sans Thai', sans-serif;
        }

        /* ×”×ª×××” ×œ×¨×¡×¤×•× ×¡×™×‘×™×•×ª ×©×œ ×”××§×œ×“×ª */
        @media (max-width: 768px) {
            .simple-keyboard .hg-button {
                font-size: 0.9em;
                padding: 0.5rem 0.3rem;
            }
            .simple-keyboard .hg-button.hg-standardBtn {
                height: 3.5rem; /* ×’×•×‘×” ×§×˜×Ÿ ×™×•×ª×¨ ×œ××¡×›×™× ×§×˜× ×™× */
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-white min-h-screen flex flex-col items-center p-6 space-y-8">

    <div class="w-full max-w-7xl flex flex-wrap lg:flex-nowrap justify-center gap-8">
        <!-- ×¤×× ×œ ×¢×•×‘×“ ×ª××™×œ× ×“×™ - ×‘×§×©×•×ª ×œ×× ×”×œ -->
        <div class="glass-panel p-8 flex-1 flex flex-col items-center min-w-[320px] lg:min-w-[45%] bg-green-50/50">
            <h2 class="text-3xl font-bold text-green-700 mb-6">×¢×•×‘×“ ×ª××™×œ× ×“×™ (×‘×§×©×•×ª ×œ×× ×”×œ)</h2>
            <div id="thaiWorkerPanel" class="grid grid-cols-2 md:grid-cols-3 gap-5 w-full">
                <!-- ×›×¤×ª×•×¨×™× ×™×™×•×•×¦×¨×• ×›××Ÿ ×‘××•×¤×Ÿ ×“×™× ××™ ×‘×××¦×¢×•×ª JavaScript -->
            </div>
        </div>

        <!-- ×¤×× ×œ ×× ×”×œ - ×”×•×¨××•×ª ×œ×¢×•×‘×“ -->
        <div class="glass-panel p-8 flex-1 flex flex-col items-center min-w-[320px] lg:min-w-[45%] bg-blue-50/50">
            <h2 class="text-3xl font-bold text-blue-700 mb-6">×× ×”×œ (×”×•×¨××•×ª ×œ×¢×•×‘×“)</h2>
            <div id="managerPanel" class="grid grid-cols-2 md:grid-cols-3 gap-5 w-full">
                <!-- ×›×¤×ª×•×¨×™× ×™×™×•×•×¦×¨×• ×›××Ÿ ×‘××•×¤×Ÿ ×“×™× ××™ ×‘×××¦×¢×•×ª JavaScript -->
            </div>
        </div>
    </div>

    <!-- ×¤×× ×œ ××©×¤×˜×™ ×ª×¨×’×•× ××™×™×“×™ -->
    <div class="glass-panel p-8 w-full max-w-7xl flex flex-col items-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">××©×¤×˜×™ ×ª×¨×’×•× ××™×™×“×™</h2>
        <div class="flex flex-wrap justify-center gap-4 mb-8 w-full">
            <!-- ×›×¤×ª×•×¨×™× ×œ××©×¤×˜×™× ×‘×¢×‘×¨×™×ª -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">×¢×‘×¨×™×ª ×œ×ª××™×ª</h3>
                <div id="instantPhrasesHe" class="grid grid-cols-1 gap-4 w-full">
                    <!-- ×›×¤×ª×•×¨×™ ××©×¤×˜×™× ×™×™×•×•×¦×¨×• ×›××Ÿ -->
                </div>
            </div>
            <!-- ×›×¤×ª×•×¨×™× ×œ××©×¤×˜×™× ×‘×ª××™×ª -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">×ª××™×ª ×œ×¢×‘×¨×™×ª</h3>
                <div id="instantPhrasesTh" class="grid grid-cols-1 gap-4 w-full">
                    <!-- ×›×¤×ª×•×¨×™ ××©×¤×˜×™× ×™×™×•×•×¦×¨×• ×›××Ÿ -->
                </div>
            </div>
             <!-- ×›×¤×ª×•×¨×™ ××¡×¤×¨×™× 1-10 ×‘×¢×‘×¨×™×ª -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5 mt-8">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">××¡×¤×¨×™× (×¢×‘×¨×™×ª ×œ×ª××™×ª)</h3>
                <div id="numberPhrasesHe" class="grid grid-cols-2 gap-4 w-full">
                    <!-- ×›×¤×ª×•×¨×™ ××¡×¤×¨×™× ×™×™×•×•×¦×¨×• ×›××Ÿ -->
                </div>
            </div>
            <!-- ×›×¤×ª×•×¨×™ ××¡×¤×¨×™× 1-10 ×‘×ª××™×ª -->
            <div class="flex flex-col items-center w-full md:w-1/2 lg:w-2/5 mt-8">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">à¸•à¸±à¸§à¹€à¸¥à¸‚ (×ª××™×ª ×œ×¢×‘×¨×™×ª)</h3>
                <div id="numberPhrasesTh" class="grid grid-cols-2 gap-4 w-full">
                    <!-- ×›×¤×ª×•×¨×™ ××¡×¤×¨×™× ×™×™×•×•×¦×¨×• ×›××Ÿ -->
                </div>
            </div>
        </div>
        <!-- ××–×•×¨ ×œ×”×¦×’×ª ×”××©×¤×˜ ×”××ª×•×¨×’× ×”××™×™×“×™ -->
        <div id="instantTranslationOutput" class="mt-8 p-6 text-2xl font-bold text-gray-900 bg-gray-50 rounded-2xl border-4 border-transparent min-h-[100px] flex items-center justify-center w-full max-w-2xl text-center shadow-lg transition-all duration-300">
            ×”××©×¤×˜ ×”××ª×•×¨×’× ×™×•×¤×™×¢ ×›××Ÿ
        </div>
    </div>

    <!-- ×¤×× ×œ ×ª×¨×’×•× ×•×›×ª×™×‘×” ×—×•×¤×©×™×ª -->
    <div class="glass-panel p-8 w-full max-w-7xl flex flex-col items-center">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">×ª×¨×’×•× ×•×›×ª×™×‘×” ×—×•×¤×©×™×ª</h2>
        <textarea id="freeTextInput" placeholder="×”×§×œ×“ ×›××Ÿ ×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª ××• ×‘×ª××™×ª..." rows="4"
                  class="w-full p-4 mb-6 text-xl border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-all resize-y shadow-sm"></textarea>
        <div class="flex flex-wrap justify-center gap-4 mb-8 w-full">
            <button id="setLangHe" class="px-8 py-4 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 transition-all text-xl">
                ×”×§×œ×“ ×‘×¢×‘×¨×™×ª
            </button>
            <button id="setLangTh" class="px-8 py-4 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 transition-all text-xl thai-text">
                à¸à¸´à¸¡à¸à¹Œà¸ à¸²à¸©à¸²à¹„à¸—à¸¢
            </button>
            <button id="speakTranslated" class="px-8 py-4 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition-all text-xl">
                ×”×©××¢ ×˜×§×¡×˜ ××ª×•×¨×’×
            </button>
        </div>
        <div class="simple-keyboard w-full"></div>
    </div>

    <!-- ×—×œ×•×Ÿ ×¤×•×¤××¤ (Popup) - ×©×›×‘×ª ×¢×œ × ×¡×ª×¨×ª ×©×ª×•×¤×™×¢ ×‘×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ -->
    <div id="popupOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div id="popupContent" class="glass-panel p-10 flex flex-col items-center justify-center max-w-lg w-11/12 transform scale-0 opacity-0 transition-all duration-300 ease-out relative">
            <p id="popupText" class="text-4xl font-bold text-center mb-8 text-gray-800"></p>
            <button id="popupReplayButton" class="px-8 py-4 bg-purple-600 text-white font-semibold rounded-full shadow-lg hover:bg-purple-700 transition-all duration-200 text-2xl">
                ğŸ”Š ×”×©××¢ ×©×•×‘
            </button>
            <button id="popupCloseButton" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-3xl font-bold">
                &times;
            </button>
            <span id="urgentIcon" class="absolute top-4 left-4 text-5xl hidden">ğŸ””</span>
        </div>
    </div>

    <!-- simple-keyboard JS CDN - ×¢×‘×•×¨ ×”××§×œ×“×ª ×”×•×•×™×¨×˜×•××œ×™×ª -->
    <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>

    <script>
        // ×›×ª×•×‘×ª ×©×¨×ª ×”×¤×œ××¡×§ ×©×œ×š - ×•×•×“× ×©×”×©×¨×ª ×¨×¥ ×¢×œ ×¤×•×¨×˜ 5000
        const SERVER_URL = 'http://localhost:5000';

        let currentAudio = null; // ××©×ª× ×” ×œ×©××™×¨×” ×¢×œ × ×’×Ÿ ×”××•×“×™×• ×”× ×•×›×—×™

        // ××œ×× ×˜×™× ×©×œ ×”×¤×•×¤××¤ ×‘-HTML
        const popupOverlay = document.getElementById('popupOverlay');
        const popupContent = document.getElementById('popupContent');
        const popupText = document.getElementById('popupText');
        const popupReplayButton = document.getElementById('popupReplayButton');
        const popupCloseButton = document.getElementById('popupCloseButton');
        const urgentIcon = document.getElementById('urgentIcon'); // ××™×™×§×•×Ÿ ×”×ª×¨××”
        let popupAudioUrl = ''; // ×™×©××•×¨ ××ª ×”-URL ×©×œ ×”××•×“×™×• ×©×”×•×©××¢ ×‘×¤×•×¤××¤
        let popupCloseTimeout; // ××©×ª× ×” ×œ×©××™×¨×ª ×”×˜×™×™×-×××•×˜ ×©×œ ×¡×’×™×¨×ª ×”×¤×•×¤××¤ ××•×˜×•××˜×™×ª

        // ××œ×× ×˜×™× ×©×œ ×ª×¨×’×•× ××™×™×“×™
        const instantTranslationOutput = document.getElementById('instantTranslationOutput');

        // ×”×’×“×¨×•×ª ××§×œ×“×ª ×•×™×¨×˜×•××œ×™×ª SimpleKeyboard
        let keyboard;
        let currentKeyboardLayout = 'hebrew'; // ×‘×¨×™×¨×ª ××—×“×œ: ×¢×‘×¨×™×ª

        // ×¤×¨×™×¡×•×ª ××§×œ×“×ª ×¢×‘×•×¨ ×¢×‘×¨×™×ª ×•×ª××™×ª (×“×•×’×××•×ª ×‘×¡×™×¡×™×•×ª)
        const layoutOptions = {
            'hebrew': {
                default: [
                    "` 1 2 3 4 5 6 7 8 9 0 - = {bksp}",
                    "{tab} / ' ×§ ×¨ ×• ×Ÿ ×˜ ×¦ ×© ×“ ×’ ×› ×¢ ×— ×™ ×œ ×£ ,",
                    "{capslock} ×– ×¡ ×‘ ×” ×  × ×š ×£ , . / \\",
                    "{shift} ×ª × ×“ ×” ×‘ ×’ ×• ×— ×– ×œ ×˜ ×¨ ×  × {shift}",
                    "{space}"
                ],
                shift: [
                    "~ ! @ # $ % ^ & * ( ) _ + {bksp}",
                    "{tab} Q W E R T Y U I O P { } |",
                    "{capslock} A S D F G H J K L : \"",
                    "{shift} Z X C V B N M < > ? {shift}",
                    "{space}"
                ]
            },
            'thai': {
                default: [
                    "à¹… / - à¸  à¸–à¸¸ à¸¹ à¸à¸¶ à¸«à¸´ à¹ˆ à¹‰ à¹‡ à¸· {bksp}",
                    "{tab} à¸à¸± à¸£à¸™ à¸° à¸•à¸£ à¸¢à¸š à¸¸à¸¢ à¸­à¸´ à¹‚ à¹‚à¸­ à¸› à¸ à¸¬",
                    "{capslock} à¸² à¸ª à¸” à¸Ÿ à¹ à¸°à¸± à¸« à¹‚ à¸„ à¸Š",
                    "{shift} à¸‹à¸© à¸¡à¸­ à¸”à¸š à¸™ à¹€ à¸— à¸ˆ à¸ à¹‡ {shift}",
                    "{space}"
                ],
                shift: [
                    "+ à¹‘ à¹’ à¹“ à¹” à¹• à¹– à¹— à¹˜ à¹™ à¹ à¸¯ à¸ à¸ {bksp}",
                    "{tab} à¸ à¸‘ à¸˜ à¹ à¹Š à¸“ à¸¡ à¸¢ à¸“à¸š à¸¸à¸¸ à¸“à¸‚ à¸“à¸„ à¸“à¸‡ {tab}",
                    "{capslock} à¸Ÿà¸° à¸«à¸° à¸à¸° à¸”à¸° à¸ªà¸± à¸°à¸± à¸™ à¸°à¸£ à¸°à¸¥ à¸°à¸­ à¸°à¹ƒ {capslock}",
                    "{shift} à¸°à¸¡ à¸°à¸™ à¸°à¸§ à¸°à¸­ à¸°à¸£ à¸°à¸ª à¸°à¸Ÿ à¸°à¸‡ à¸°à¸ˆ à¸°à¸„ à¸°à¸¥ {shift}",
                    "{space}"
                ]
            }
        };

        // ×××’×¨ ×§×‘×¦×™ ××•×“×™×• ×‘×¤×•×¨××˜ Base64
        // ×—×©×•×‘: ××œ×• ×”× ×§×‘×¦×™ ×“××”. ×¢×œ×™×š ×œ×”×—×œ×™×£ ××ª ×”-Base64 ×‘×§×‘×¦×™ ××•×“×™×• ×××™×ª×™×™× ××©×œ×š.
        // ×ª×•×›×œ ×œ×”×©×ª××© ×‘×›×œ×™× ××§×•×•× ×™× ××• ×¡×§×¨×™×¤×˜×™× ×›×“×™ ×œ×”××™×¨ ×§×‘×¦×™ MP3/WAV ×œ-Base64.
        // ×“×•×’××”: he_break_1 ×”×•× ××•×“×™×• ×œ"×× ×™ ×¨×•×¦×” ×”×¤×¡×§×”."
        const base64AudioData = {
            "he_break_1": "data:audio/mpeg;base64,TBD_HE_BREAK_1_BASE64_AUDIO_HERE", // ×œ×“×•×’××”, ×§×•×‘×¥ ××•×“×™×• ×‘-Base64 ×¢×‘×•×¨ "×× ×™ ×¨×•×¦×” ×”×¤×¡×§×”."
            "th_break_1": "data:audio/mpeg;base64,TBD_TH_BREAK_1_BASE64_AUDIO_HERE", // ×œ×“×•×’××”, ×§×•×‘×¥ ××•×“×™×• ×‘-Base64 ×¢×‘×•×¨ "à¸œà¸¡/à¸‰à¸±à¸™ à¸‚à¸­à¸à¸±à¸"
            "he_toilet_1": "data:audio/mpeg;base64,TBD_HE_TOILET_1_BASE64_AUDIO_HERE",
            "th_toilet_1": "data:audio/mpeg;base64,TBD_TH_TOILET_1_BASE64_AUDIO_HERE",
            "he_help_1": "data:audio/mpeg;base64,TBD_HE_HELP_1_BASE64_AUDIO_HERE",
            "th_help_1": "data:audio/mpeg;base64,TBD_TH_HELP_1_BASE64_AUDIO_HERE",
            "he_sick_1": "data:audio/mpeg;base64,TBD_HE_SICK_1_BASE64_AUDIO_HERE",
            "th_sick_1": "data:audio/mpeg;base64,TBD_TH_SICK_1_BASE64_AUDIO_HERE",
            "he_load_cement_1": "data:audio/mpeg;base64,TBD_HE_LOAD_CEMENT_1_BASE64_AUDIO_HERE",
            "th_load_cement_1": "data:audio/mpeg;base64,TBD_TH_LOAD_CEMENT_1_BASE64_AUDIO_HERE",
            "he_load_bags_1": "data:audio/mpeg;base64,TBD_HE_LOAD_BAGS_1_BASE64_AUDIO_HERE",
            "th_load_bags_1": "data:audio/mpeg;base64,TBD_TH_LOAD_BAGS_1_BASE64_AUDIO_HERE",
            "he_help_alaa_1": "data:audio/mpeg;base64,TBD_HE_HELP_ALAA_1_BASE64_AUDIO_HERE",
            "th_help_alaa_1": "data:audio/mpeg;base64,TBD_TH_HELP_ALAA_1_BASE64_AUDIO_HERE",
            "he_help_adham_1": "data:audio/mpeg;base64,TBD_HE_HELP_ADHAM_1_BASE64_AUDIO_HERE",
            "th_help_adham_1": "data:audio/mpeg;base64,TBD_TH_HELP_ADHAM_1_BASE64_AUDIO_HERE",
            "he_help_store_1": "data:audio/mpeg;base64,TBD_HE_HELP_STORE_1_BASE64_AUDIO_HERE",
            "th_help_store_1": "data:audio/mpeg;base64,TBD_TH_HELP_STORE_1_BASE64_AUDIO_HERE",
            "he_next_product_1": "data:audio/mpeg;base64,TBD_HE_NEXT_PRODUCT_1_BASE64_AUDIO_HERE",
            "th_next_product_1": "data:audio/mpeg;base64,TBD_TH_NEXT_PRODUCT_1_BASE64_AUDIO_HERE",
            "he_good_morning_1": "data:audio/mpeg;base64,TBD_HE_GOOD_MORNING_1_BASE64_AUDIO_HERE",
            "th_good_morning_1": "data:audio/mpeg;base64,TBD_TH_GOOD_MORNING_1_BASE64_AUDIO_HERE",
            "he_good_evening_1": "data:audio/mpeg;base64,TBD_HE_GOOD_EVENING_1_BASE64_AUDIO_HERE",
            "th_good_evening_1": "data:audio/mpeg;base64,TBD_TH_GOOD_EVENING_1_BASE64_AUDIO_HERE",
            "he_how_are_you_1": "data:audio/mpeg;base64,TBD_HE_HOW_ARE_YOU_1_BASE64_AUDIO_HERE",
            "th_how_are_you_1": "data:audio/mpeg;base64,TBD_TH_HOW_ARE_YOU_1_BASE64_AUDIO_HERE",
            "he_how_do_you_feel_1": "data:audio/mpeg;base64,TBD_HE_HOW_DO_YOU_FEEL_1_BASE64_AUDIO_HERE",
            "th_how_do_you_feel_1": "data:audio/mpeg;base64,TBD_TH_HOW_DO_YOU_FEEL_1_BASE64_AUDIO_HERE",
            "he_come_help_loading_1": "data:audio/mpeg;base64,TBD_HE_COME_HELP_LOADING_1_BASE64_AUDIO_HERE",
            "th_come_help_loading_1": "data:audio/mpeg;base64,TBD_TH_COME_HELP_LOADING_1_BASE64_AUDIO_HERE"
        };


        // ×××’×¨ ×”××©×¤×˜×™× ×”×¨××©×™ ×¢×‘×•×¨ ×›×¤×ª×•×¨×™ ×”×¤×× ×œ×™×
        const phrasesData = [
          { "id": "thai_break_request_1", "display_text": "×”×¤×¡×§×”", "icon": "â˜•", "he_text": "×× ×™ ×¨×•×¦×” ×”×¤×¡×§×”.", "th_text": "à¸œà¸¡/à¸‰à¸±à¸™ à¸‚à¸­à¸à¸±à¸", "he_audio_id": "he_break_1", "th_audio_id": "th_break_1", "panel": "thai_worker", "is_urgent": false },
          { "id": "thai_toilet_request_1", "display_text": "×©×™×¨×•×ª×™×", "icon": "ğŸš½", "he_text": "×× ×™ ×¦×¨×™×š ×œ×©×™×¨×•×ª×™×.", "th_text": "à¸œà¸¡/à¸‰à¸±à¸™ à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹„à¸›à¸«à¹‰à¸­à¸‡à¸™à¹‰à¸³", "he_audio_id": "he_toilet_1", "th_audio_id": "th_toilet_1", "panel": "thai_worker", "is_urgent": false },
          { "id": "thai_help_request_1", "display_text": "×¢×–×¨×”", "icon": "âœ‹", "he_text": "×× ×™ ×¦×¨×™×š ×¢×–×¨×”.", "th_text": "à¸œà¸¡/à¸‰à¸±à¸™ à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸„à¸§à¸²à¸¡à¸Šà¹ˆà¸§à¸¢à¹€à¸«à¸¥à¸·à¸­", "he_audio_id": "he_help_1", "th_audio_id": "th_help_1", "panel": "thai_worker", "is_urgent": true },
          { "id": "thai_sick_request_1", "display_text": "×—×•×œ×”", "icon": "ğŸ˜·", "he_text": "×× ×™ ××¨×’×™×© ×—×•×œ×”.", "th_text": "à¸œà¸¡/à¸‰à¸±à¸™ à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹„à¸¡à¹ˆà¸ªà¸šà¸²à¸¢", "he_audio_id": "he_sick_1", "th_audio_id": "th_sick_1", "panel": "thai_worker", "is_urgent": true },
          { "id": "thai_good_morning_1", "display_text": "×‘×•×§×¨ ×˜×•×‘", "icon": "â˜€ï¸", "he_text": "×‘×•×§×¨ ×˜×•×‘.", "th_text": "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸•à¸­à¸™à¹€à¸Šà¹‰à¸²", "he_audio_id": "he_good_morning_1", "th_audio_id": "th_good_morning_1", "panel": "thai_worker", "is_urgent": false },
          { "id": "thai_good_evening_1", "display_text": "×¢×¨×‘ ×˜×•×‘", "icon": "ğŸŒ™", "he_text": "×¢×¨×‘ ×˜×•×‘.", "th_text": "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸•à¸­à¸™à¹€à¸¢à¹‡à¸™", "he_audio_id": "he_good_evening_1", "th_audio_id": "th_good_evening_1", "panel": "thai_worker", "is_urgent": false },
          { "id": "thai_how_are_you_1", "display_text": "××” ×©×œ×•××š?", "icon": "ï¿½", "he_text": "××” ×©×œ×•××š?", "th_text": "à¸ªà¸šà¸²à¸¢à¸”à¸µà¹„à¸«à¸¡?", "he_audio_id": "he_how_are_you_1", "th_audio_id": "th_how_are_you_1", "panel": "thai_worker", "is_urgent": false },
          { "id": "thai_how_do_you_feel_1", "display_text": "××™×š ××¨×’×™×©?", "icon": "ğŸ¤’", "he_text": "××™×š ××ª×” ××¨×’×™×©?", "th_text": "à¸„à¸¸à¸“à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", "he_audio_id": "he_how_do_you_feel_1", "th_audio_id": "th_how_do_you_feel_1", "panel": "thai_worker", "is_urgent": false },

          { "id": "manager_load_cement_1", "display_text": "×”×¢××¡ ××œ×˜", "icon": "ğŸ“¦", "he_text": "×ª×¢××™×¡ ××œ×˜.", "th_text": "à¸‚à¸™à¸›à¸¹à¸™", "he_audio_id": "he_load_cement_1", "th_audio_id": "th_load_cement_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_organize_area_1", "display_text": "×¡×“×¨ ××–×•×¨", "icon": "ğŸ§¹", "he_text": "×ª×‘×•× ×ª×¡×“×¨ ××ª ×”××–×•×¨ ×”×–×”.", "th_text": "à¸¡à¸²à¸ˆà¸±à¸”à¸£à¸°à¹€à¸šà¸µà¸¢à¸šà¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸™à¸µà¹‰à¸«à¸™à¹ˆà¸­à¸¢", "he_audio_id": "he_organize_area_1", "th_audio_id": "th_organize_area_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_clean_table_1", "display_text": "× ×§×” ×©×•×œ×—×Ÿ", "icon": "ğŸ§¼", "he_text": "×ª× ×§×” ××ª ×”×©×•×œ×—×Ÿ.", "th_text": "à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”à¹‚à¸•à¹Šà¸°", "he_audio_id": "he_clean_table_1", "th_audio_id": "th_clean_table_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_finish_now_1", "display_text": "×¡×™×™× ×¢×›×©×™×•", "icon": "â±ï¸", "he_text": "×ª×¡×™×™× ××ª ×”×¢×‘×•×“×” ×¢×›×©×™×•.", "th_text": "à¸—à¸³à¸‡à¸²à¸™à¹ƒà¸«à¹‰à¹€à¸ªà¸£à¹‡à¸ˆà¹€à¸”à¸µà¹‹à¸¢à¸§à¸™à¸µà¹‰", "he_audio_id": "he_finish_now_1", "th_audio_id": "th_finish_now_1", "panel": "manager", "is_urgent": true },
          { "id": "manager_come_here_1", "display_text": "×‘×•× ×œ×›××Ÿ", "icon": "ğŸš¶â€â™‚ï¸", "he_text": "×‘×•× ×œ×›××Ÿ ×‘×‘×§×©×”.", "th_text": "à¸¡à¸²à¸™à¸µà¹ˆà¸«à¸™à¹ˆà¸­à¸¢à¸„à¸£à¸±à¸š/à¸„à¹ˆà¸°", "he_audio_id": "he_come_here_1", "th_audio_id": "th_come_here_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_wait_1", "display_text": "×—×›×” ×¨×’×¢", "icon": "â°", "he_text": "×—×›×” ×¨×’×¢ ×‘×‘×§×©×”.", "th_text": "à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆà¸„à¸£à¸±à¸š/à¸„à¹ˆà¸°", "he_audio_id": "he_wait_1", "th_audio_id": "th_wait_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_move_bags_1", "display_text": "×”×¢×‘×¨ ×©×§×™×", "icon": "â¡ï¸ğŸ›ï¸", "he_text": "×œ×”×¢×‘×™×¨ ××ª ×”×©×§×™×.", "th_text": "à¸¢à¹‰à¸²à¸¢à¸à¸£à¸°à¸ªà¸­à¸š", "he_audio_id": "he_load_bags_1", "th_audio_id": "th_load_bags_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_help_alaa_1", "display_text": "×¢×–×•×¨ ×œ×¢×œ××", "icon": "ğŸ¤", "he_text": "×œ×¢×–×•×¨ ×œ×¢×œ××.", "th_text": "à¸Šà¹ˆà¸§à¸¢à¸­à¸¥à¸µà¸­à¸²", "he_audio_id": "he_help_alaa_1", "th_audio_id": "th_help_alaa_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_help_adham_1", "display_text": "×¢×–×•×¨ ×œ××“×”×", "icon": "ğŸ¤", "he_text": "×œ×¢×–×•×¨ ×œ××“×”×.", "th_text": "à¸Šà¹ˆà¸§à¸¢à¸­à¸”à¸±à¸¡", "he_audio_id": "he_help_adham_1", "th_audio_id": "th_help_adham_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_help_store_1", "display_text": "×¢×–×•×¨ ×œ×—× ×•×ª", "icon": "ğŸª", "he_text": "×œ×¢×–×•×¨ ×œ×—× ×•×ª.", "th_text": "à¸Šà¹ˆà¸§à¸¢à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²", "he_audio_id": "he_help_store_1", "th_audio_id": "th_help_store_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_next_product_1", "display_text": "×”×‘× ××•×¦×¨", "icon": "ğŸ“¦â¡ï¸", "he_text": "×œ×œ×›×ª ×œ×”×‘×™× ××ª ×”××•×¦×¨ ×”×‘×.", "th_text": "à¹„à¸›à¹€à¸­à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¸Šà¸´à¹‰à¸™à¸•à¹ˆà¸­à¹„à¸›", "he_audio_id": "he_next_product_1", "th_audio_id": "th_next_product_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_good_morning_1", "display_text": "×‘×•×§×¨ ×˜×•×‘", "icon": "â˜€ï¸", "he_text": "×‘×•×§×¨ ×˜×•×‘.", "th_text": "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸•à¸­à¸™à¹€à¸Šà¹‰à¸²", "he_audio_id": "he_good_morning_1", "th_audio_id": "th_good_morning_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_good_evening_1", "display_text": "×¢×¨×‘ ×˜×•×‘", "icon": "ğŸŒ™", "he_text": "×¢×¨×‘ ×˜×•×‘.", "th_text": "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸•à¸­à¸™à¹€à¸¢à¹‡à¸™", "he_audio_id": "he_good_evening_1", "th_audio_id": "th_good_evening_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_how_are_you_1", "display_text": "××” ×©×œ×•××š?", "icon": "ğŸ˜Š", "he_text": "××” ×©×œ×•××š?", "th_text": "à¸ªà¸šà¸²à¸¢à¸”à¸µà¹„à¸«à¸¡?", "he_audio_id": "he_how_are_you_1", "th_audio_id": "th_how_are_you_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_how_do_you_feel_1", "display_text": "××™×š ××¨×’×™×©?", "icon": "ğŸ¤’", "he_text": "××™×š ××ª×” ××¨×’×™×©?", "th_text": "à¸„à¸¸à¸“à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", "he_audio_id": "he_how_do_you_feel_1", "th_audio_id": "th_how_do_you_feel_1", "panel": "manager", "is_urgent": false },
          { "id": "manager_come_help_loading_1", "display_text": "×‘×•× ×œ×¢×–×•×¨", "icon": "ğŸ’ª", "he_text": "×‘×•× ×ª×¢×–×•×¨ ×œ×™ ×‘×”×¢××¡×”.", "th_text": "à¸¡à¸²à¸Šà¹ˆà¸§à¸¢à¸œà¸¡/à¸‰à¸±à¸™ à¸‚à¸™à¸‚à¸­à¸‡à¸«à¸™à¹ˆà¸­à¸¢", "he_audio_id": "he_come_help_loading_1", "th_audio_id": "th_come_help_loading_1", "panel": "manager", "is_urgent": false }
        ];

        // ×¨×©×™××ª ××©×¤×˜×™× ×œ×ª×¨×’×•× ××™×™×“×™ (×§×‘×•×¢×™× ×‘-JS)
        const instantPhrases = {
            hebrew: [
                "×›××” ×©×§×™× ×œ×”×¢××™×¡?",
                "×× ×™ ×¦×¨×™×š ×¢×–×¨×” ×¢×›×©×™×• ×‘×‘×§×©×”.",
                "××™×¤×” × ××¦× ×”××—×¡×Ÿ?",
                "×”×œ×§×•×— ×”×–×” ××—×›×” ×œ×™.",
                "×”×× ×¡×™×™××ª ××ª ×”××©×™××”?"
            ],
            thai: [
                "à¸•à¹‰à¸­à¸‡à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”à¸•à¸­à¸™à¸™à¸µà¹‰à¹„à¸«à¸¡?", // Should I clean now?
                "à¸¥à¸¹à¸à¸„à¹‰à¸²à¸ˆà¸°à¸¡à¸²à¸–à¸¶à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆ?", // When will the customer arrive?
                "à¸¡à¸µà¸‡à¸²à¸™à¸­à¸°à¹„à¸£à¸­à¸µà¸à¹„à¸«à¸¡?", // Is there any more work?
                "à¸œà¸¡/à¸‰à¸±à¸™ à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ à¸Šà¹ˆà¸§à¸¢à¸­à¸˜à¸´à¸šà¸²à¸¢à¸«à¸™à¹ˆà¸­à¸¢.", // I don't understand, please explain.
                "à¸‚à¸­à¸­à¸™à¸¸à¸à¸²à¸•à¹„à¸›à¸‹à¸·à¹‰à¸­à¸‚à¸­à¸‡à¹„à¸”à¹‰à¹„à¸«à¸¡?" // May I go buy something?
            ],
            hebrew_numbers: [
                "××¡×¤×¨ ××—×ª", "××¡×¤×¨ ×©×ª×™×™×", "××¡×¤×¨ ×©×œ×•×©", "××¡×¤×¨ ××¨×‘×¢", "××¡×¤×¨ ×—××©",
                "××¡×¤×¨ ×©×©", "××¡×¤×¨ ×©×‘×¢", "××¡×¤×¨ ×©××•× ×”", "××¡×¤×¨ ×ª×©×¢", "××¡×¤×¨ ×¢×©×¨"
            ],
            thai_numbers: [
                "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸«à¸™à¸¶à¹ˆà¸‡", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸ªà¸­à¸‡", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸ªà¸²à¸¡", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸ªà¸µà¹ˆ", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸«à¹‰à¸²",
                "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸«à¸", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸ˆà¹‡à¸”", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹à¸›à¸”", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¹€à¸à¹‰à¸²", "à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸ªà¸´à¸š"
            ]
        };


        // ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª × ×ª×•× ×™ ×”××©×¤×˜×™× (×”×××’×¨ ×¢×›×©×™×• ××•×‘× ×” ×‘-JS)
        async function loadPhrases() {
            // ××™×Ÿ ×¦×•×¨×š ×‘-fetch ×œ×§×•×‘×¥ ×—×™×¦×•× ×™, ×”× ×ª×•× ×™× ×›×‘×¨ ×›××Ÿ
            renderButtons(phrasesData);
            renderInstantPhraseButtons(); // ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×¨×™× ×“×•×¨ ×”××©×¤×˜×™× ×”××™×™×“×™×™×
            renderNumberPhraseButtons(); // ×§×¨×™××” ×œ×¤×•× ×§×¦×™×™×ª ×¨×™× ×“×•×¨ ×›×¤×ª×•×¨×™ ×”××¡×¤×¨×™×
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×›×¤×ª×•×¨×™× ×•×”×¦×’×ª× ×‘×¤×× ×œ×™× ×”××ª××™××™× (××©×¤×˜×™× ×§×‘×•×¢×™×)
        function renderButtons(phrases) {
            const thaiWorkerPanel = document.getElementById('thaiWorkerPanel');
            const managerPanel = document.getElementById('managerPanel');

            // × ×™×§×•×™ ×”×¤×× ×œ×™× ×œ×¤× ×™ ×”×•×¡×¤×ª ×›×¤×ª×•×¨×™×
            thaiWorkerPanel.innerHTML = '';
            managerPanel.innerHTML = '';


            phrases.forEach(phrase => {
                const button = document.createElement('button');
                // Tailwind classes for consistent button styling
                button.classList.add(
                    'flex', 'flex-col', 'items-center', 'justify-center', 'px-4', 'py-4', 'rounded-2xl', 'font-semibold',
                    'shadow-lg', 'hover:shadow-xl', 'transition-all', 'duration-200', 'active:scale-95',
                    'text-xl', 'text-white', 'text-center', 'min-h-[120px]', 'space-y-2' // ×¨×•×•×— ×‘×™×Ÿ ×”××™×™×§×•×Ÿ ×œ×˜×§×¡×˜
                );

                const iconSpan = document.createElement('span');
                iconSpan.textContent = phrase.icon || ''; // ×”×•×¡×£ ××™×™×§×•×Ÿ ×× ×§×™×™×
                iconSpan.classList.add('text-4xl'); // ×’×•×“×œ ×’×“×•×œ ×œ××™×™×§×•×Ÿ

                const textSpan = document.createElement('span');
                textSpan.textContent = phrase.display_text || phrase.he_text; // ×˜×§×¡×˜ ×”×›×¤×ª×•×¨

                button.appendChild(iconSpan);
                button.appendChild(textSpan);

                if (phrase.panel === 'thai_worker') {
                    // ×›×¤×ª×•×¨ ×œ×¢×•×‘×“ ×ª××™×œ× ×“×™: ××¦×™×’ ×˜×§×¡×˜ ×¢×‘×¨×™ ×§×¦×¨, ×‘×œ×—×™×¦×” ××©××™×¢ ×¢×‘×¨×™×ª ×œ×× ×”×œ, ××¦×™×’ ×¤×•×¤××¤ ×‘×¢×‘×¨×™×ª
                    // ×©×™××•×© ×‘-base64AudioData ×‘××§×•× audioPath
                    button.onclick = () => {
                        const audioData = base64AudioData[phrase.he_audio_id];
                        if (!audioData || audioData.includes("TBD_")) {
                            console.warn(`×”×•×“×¢×”: ×§×•×‘×¥ ××•×“×™×• ×¢×‘×•×¨ ${phrase.he_audio_id} ×”×•× ×“××”. ×× × ×”×—×œ×£ ××•×ª×• ×‘××•×“×™×• ×××™×ª×™.`);
                        }
                        showPopup(phrase.he_text, audioData, 'he', phrase.is_urgent);
                    };
                    button.classList.add('bg-green-600', 'hover:bg-green-700'); // ×¦×‘×¢ ×™×¨×•×§ ×œ×¢×•×‘×“
                    thaiWorkerPanel.appendChild(button);
                } else if (phrase.panel === 'manager') {
                    // ×›×¤×ª×•×¨ ×œ×× ×”×œ: ××¦×™×’ ×˜×§×¡×˜ ×¢×‘×¨×™ ×§×¦×¨, ×‘×œ×—×™×¦×” ××©××™×¢ ×ª××™×ª ×œ×¢×•×‘×“, ××¦×™×’ ×¤×•×¤××¤ ×‘×ª××™×ª
                    // ×©×™××•×© ×‘-base64AudioData ×‘××§×•× audioPath
                    button.onclick = () => {
                        const audioData = base64AudioData[phrase.th_audio_id];
                        if (!audioData || audioData.includes("TBD_")) {
                            console.warn(`×”×•×“×¢×”: ×§×•×‘×¥ ××•×“×™×• ×¢×‘×•×¨ ${phrase.th_audio_id} ×”×•× ×“××”. ×× × ×”×—×œ×£ ××•×ª×• ×‘××•×“×™×• ×××™×ª×™.`);
                        }
                        showPopup(phrase.th_text, audioData, 'th', phrase.is_urgent);
                    };
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700'); // ×¦×‘×¢ ×›×—×•×œ ×œ×× ×”×œ
                    managerPanel.appendChild(button);
                }
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×›×¤×ª×•×¨×™ ××©×¤×˜×™× ×œ×ª×¨×’×•× ××™×™×“×™
        function renderInstantPhraseButtons() {
            const instantPhrasesHePanel = document.getElementById('instantPhrasesHe');
            const instantPhrasesThPanel = document.getElementById('instantPhrasesTh');

            instantPhrasesHePanel.innerHTML = '';
            instantPhrasesThPanel.innerHTML = '';

            // ×›×¤×ª×•×¨×™× ×œ×¢×‘×¨×™×ª (×™×ª×•×¨×’××• ×œ×ª××™×ª)
            instantPhrases.hebrew.forEach(phraseText => {
                const button = document.createElement('button');
                button.classList.add(
                    'flex', 'items-center', 'justify-center', 'px-4', 'py-3', 'rounded-lg', 'font-medium',
                    'shadow-md', 'hover:shadow-lg', 'transition-all', 'duration-200', 'active:scale-95',
                    'text-lg', 'text-white', 'text-center',
                    'bg-indigo-500', 'hover:bg-indigo-600' // ×¦×‘×¢×™ ×›×¤×ª×•×¨×™× ×œ××©×¤×˜×™× ××™×™×“×™×™×
                );
                button.textContent = phraseText;
                button.onclick = () => translateAndDisplayInstant(phraseText, 'he', 'th');
                instantPhrasesHePanel.appendChild(button);
            });

            // ×›×¤×ª×•×¨×™× ×œ×ª××™×ª (×™×ª×•×¨×’××• ×œ×¢×‘×¨×™×ª)
            instantPhrases.thai.forEach(phraseText => {
                const button = document.createElement('button');
                button.classList.add(
                    'flex', 'items-center', 'justify-center', 'px-4', 'py-3', 'rounded-lg', 'font-medium',
                    'shadow-md', 'hover:shadow-lg', 'transition-all', 'duration-200', 'active:scale-95',
                    'text-lg', 'text-white', 'text-center',
                    'bg-purple-500', 'hover:bg-purple-600', 'thai-text' // ×¦×‘×¢×™× ×•×¤×•× ×˜ ×œ×ª××™×ª
                );
                button.textContent = phraseText;
                button.onclick = () => translateAndDisplayInstant(phraseText, 'th', 'he');
                instantPhrasesThPanel.appendChild(button);
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×›×¤×ª×•×¨×™ ××¡×¤×¨×™×
        function renderNumberPhraseButtons() {
            const numberPhrasesHePanel = document.getElementById('numberPhrasesHe');
            const numberPhrasesThPanel = document.getElementById('numberPhrasesTh');

            numberPhrasesHePanel.innerHTML = '';
            numberPhrasesThPanel.innerHTML = '';

            // ×›×¤×ª×•×¨×™ ××¡×¤×¨×™× ×‘×¢×‘×¨×™×ª (×™×ª×•×¨×’××• ×œ×ª××™×ª)
            instantPhrases.hebrew_numbers.forEach((phraseText, index) => {
                const button = document.createElement('button');
                button.classList.add(
                    'flex', 'items-center', 'justify-center', 'px-4', 'py-3', 'rounded-lg', 'font-medium',
                    'shadow-md', 'hover:shadow-lg', 'transition-all', 'duration-200', 'active:scale-95',
                    'text-xl', 'text-white', 'text-center',
                    'bg-pink-500', 'hover:bg-pink-600' // ×¦×‘×¢×™ ×›×¤×ª×•×¨×™× ×œ××¡×¤×¨×™×
                );
                button.textContent = `${index + 1}. ${phraseText}`; // ××¦×™×’ "1. ××¡×¤×¨ ××—×ª"
                button.onclick = () => translateAndDisplayInstant(phraseText, 'he', 'th');
                numberPhrasesHePanel.appendChild(button);
            });

            // ×›×¤×ª×•×¨×™ ××¡×¤×¨×™× ×‘×ª××™×ª (×™×ª×•×¨×’××• ×œ×¢×‘×¨×™×ª)
            instantPhrases.thai_numbers.forEach((phraseText, index) => {
                const button = document.createElement('button');
                button.classList.add(
                    'flex', 'items-center', 'justify-center', 'px-4', 'py-3', 'rounded-lg', 'font-medium',
                    'shadow-md', 'hover:shadow-lg', 'transition-all', 'duration-200', 'active:scale-95',
                    'text-xl', 'text-white', 'text-center',
                    'bg-teal-500', 'hover:bg-teal-600', 'thai-text' // ×¦×‘×¢×™× ×•×¤×•× ×˜ ×œ×ª××™×ª
                );
                button.textContent = `${index + 1}. ${phraseText}`; // ××¦×™×’ "1. à¸«à¸¡à¸²à¸¢à¹€à¸¥à¸‚à¸«à¸™à¸¶à¹ˆà¸‡"
                button.onclick = () => translateAndDisplayInstant(phraseText, 'th', 'he');
                numberPhrasesThPanel.appendChild(button);
            });
        }


        // ×¤×•× ×§×¦×™×” ×œ×”×©××¢×ª ×§×•×‘×¥ ××•×“×™×• (××§×‘×œ×ª Base64 Data URL)
        function playAudio(audioDataUrl) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            // ×”×•×¡×¤×ª ×‘×“×™×§×” ×× ×”-audioDataUrl ×ª×§×™×Ÿ ×œ×¤× ×™ ×™×¦×™×¨×ª ××•×‘×™×™×§×˜ Audio
            if (!audioDataUrl || audioDataUrl.includes("TBD_")) {
                console.error("×©×’×™××” ×‘×”×©××¢×ª ××•×“×™×•: ×§×•×‘×¥ ××•×“×™×• ×œ× ×ª×§×™×Ÿ ××• ×—×¡×¨.");
                // × ×™×ª×Ÿ ×œ×”×¦×™×’ ×”×•×“×¢×” ×œ××©×ª××© ×›××Ÿ ×‘××§×•× ×¨×§ ×‘×§×•× ×¡×•×œ
                return;
            }
            currentAudio = new Audio(audioDataUrl);
            currentAudio.play().catch(e => console.error("×©×’×™××” ×‘×”×©××¢×ª ××•×“×™×•:", e, "Source:", audioDataUrl));
        }

        // ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×”×¤×•×¤××¤ (×œ××©×¤×˜×™× ×§×‘×•×¢×™× ×•×§×œ×˜ ×—×•×¤×©×™)
        function showPopup(text, audioDataUrl, lang, isUrgent = false) {
            popupText.textContent = text;
            popupText.dir = (lang === 'he' ? 'rtl' : 'ltr'); // ×”×’×“×¨ ×›×™×•×•×Ÿ ×˜×§×¡×˜ ×‘×¤×•×¤××¤
            
            // ×”×’×“×¨ ×¤×•× ×˜ ×ª××™×ª ×× ×”×©×¤×” ×”×™× ×ª××™×ª
            if (lang === 'th') {
                popupText.classList.add('thai-text');
            } else {
                popupText.classList.remove('thai-text');
            }

            popupAudioUrl = audioDataUrl; // ×©××•×¨ ××ª ×”-URL ×©×œ ×”××•×“×™×• ×œ×”×©××¢×” ×—×•×–×¨×ª

            // ××¤×¡ ×× ×™××¦×™×•×ª ×§×•×“××•×ª
            popupContent.classList.remove('popup-animate', 'urgent-popup-animate', 'scale-100', 'opacity-100');
            popupContent.classList.add('scale-0', 'opacity-0');

            // ×”×¦×’/×”×¡×ª×¨ ××™×™×§×•×Ÿ ×”×ª×¨××” ×•×¤×¢×œ ×× ×™××¦×™×” ×“×—×•×¤×”
            if (isUrgent) {
                urgentIcon.classList.remove('hidden');
                popupContent.classList.add('urgent-popup-animate');
            } else {
                urgentIcon.classList.add('hidden');
            }

            popupOverlay.classList.remove('hidden'); // ×”×¦×’ ××ª ×”××•×‘×¨×œ×™×™
            // ×”×¤×¢×œ ×× ×™××¦×™×™×ª ×¤×ª×™×—×” + ×”×‘×”×•×‘ ×œ××—×¨ ×©×”××•×‘×¨×œ×™×™ × ×¨××”
            setTimeout(() => {
                popupContent.classList.remove('scale-0', 'opacity-0');
                popupContent.classList.add('scale-100', 'opacity-100');
                if (!isUrgent) { // ×× ×–×” ×œ× ×“×—×•×£, ×”×¤×¢×œ ×× ×™××¦×™×” ×¨×’×™×œ×”
                    popupContent.classList.add('popup-animate');
                }
            }, 50); // ×”×©×”×™×™×” ×§×œ×” ×›×“×™ ×œ××¤×©×¨ ×œ×¨×™× ×“×•×¨ ×œ×§×¨×•×ª

            playAudio(audioDataUrl); // ×”×©××¢ ××ª ×”×§×•×œ ×‘××•×¤×Ÿ ××™×™×“×™

            // ×¡×’×•×¨ ××ª ×”×¤×•×¤××¤ ××•×˜×•××˜×™×ª ×œ××—×¨ 5 ×©× ×™×•×ª
            clearTimeout(popupCloseTimeout); // × ×§×” ×˜×™×™×-×××•×˜ ×§×•×“× ×× ×”×™×”
            popupCloseTimeout = setTimeout(hidePopup, 5000);
        }

        // ×¤×•× ×§×¦×™×” ×œ×¡×’×™×¨×ª ×”×¤×•×¤××¤
        function hidePopup() {
            // ×”×¡×¨ ×× ×™××¦×™×™×ª ×”×‘×”×•×‘ ×•×”×¤×¢×œ ×× ×™××¦×™×™×ª ×¡×’×™×¨×”
            popupContent.classList.remove('popup-animate', 'urgent-popup-animate', 'scale-100', 'opacity-100');
            popupContent.classList.add('scale-0', 'opacity-0');
            setTimeout(() => {
                popupOverlay.classList.add('hidden'); // ×”×¡×ª×¨ ××ª ×”××•×‘×¨×œ×™×™ ×œ×—×œ×•×˜×™×Ÿ ×œ××—×¨ ×”×× ×™××¦×™×”
                urgentIcon.classList.add('hidden'); // ×•×•×“× ×©××™×™×§×•×Ÿ ×”×”×ª×¨××” ××•×¡×ª×¨
            }, 300); // ×ª×•×× ××ª ××©×š ×”××¢×‘×¨ (transition) ×‘-CSS
            clearTimeout(popupCloseTimeout); // × ×§×” ××ª ×”×˜×™×™×-×××•×˜ ×©×œ ×¡×’×™×¨×” ××•×˜×•××˜×™×ª
        }

        // ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ ×”×©××¢×” ×—×•×–×¨×ª ×‘×¤×•×¤××¤
        popupReplayButton.addEventListener('click', () => {
            playAudio(popupAudioUrl);
        });

        // ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ ×¡×’×™×¨×” ×‘×¤×•×¤××¤
        popupCloseButton.addEventListener('click', hidePopup);

        // ×œ×—×™×¦×” ×¢×œ ×”××•×‘×¨×œ×™×™ ×¡×•×’×¨×ª ××ª ×”×¤×•×¤××¤
        popupOverlay.addEventListener('click', (e) => {
            if (e.target === popupOverlay) { // ×•×•×“× ×©×”×œ×—×™×¦×” ×”×™×™×ª×” ×¢×œ ×”××•×‘×¨×œ×™×™ ×¢×¦××• ×•×œ× ×¢×œ ×”×ª×•×›×Ÿ
                hidePopup();
            }
        });


        // ----- ×œ×•×’×™×§×” ×¢×‘×•×¨ ×ª×¨×’×•× ××©×¤×˜×™× ××™×™×“×™×™× -----

        let typingInterval;

        // ×¤×•× ×§×¦×™×” ×œ×ª×¨×’×•× ×•×”×¦×’×” ×¢× ×× ×™××¦×™×” ×¢×‘×•×¨ ××©×¤×˜×™× ××™×™×“×™×™×
        async function translateAndDisplayInstant(text, sourceLang, targetLang) {
            instantTranslationOutput.textContent = '××ª×¨×’×...'; // ×”×•×“×¢×ª ×˜×¢×™× ×”
            instantTranslationOutput.classList.remove('rainbow-border'); // ×”×¡×¨ ×× ×™××¦×™×” ×§×•×“××ª
            instantTranslationOutput.classList.remove('typing-effect'); // ×”×¡×¨ ××¤×§×˜ ×§×œ×“×” ×§×•×“×
            instantTranslationOutput.classList.remove('thai-text'); // ×”×¡×¨ ×¤×•× ×˜ ×ª××™×ª ×× ×œ× ×¨×œ×•×•× ×˜×™

            // ×§×‘×™×¢×ª ×›×™×•×•×Ÿ ×˜×§×¡×˜ ×œ××–×•×¨ ×”×ª×¨×’×•× ×”××™×™×“×™
            instantTranslationOutput.dir = (targetLang === 'he' ? 'rtl' : 'ltr');
            if (targetLang === 'th') {
                instantTranslationOutput.classList.add('thai-text');
            } else {
                instantTranslationOutput.classList.remove('thai-text');
            }

            try {
                // ×©×œ×‘ 1: ×‘×§×©×” ×œ×©×¨×ª ×”×¤×œ××¡×§ ×œ×§×‘×œ×ª ×§×•×‘×¥ ×”××•×“×™×• ×©×œ ×”×ª×¨×’×•×
                const audioResponse = await fetch(`${SERVER_URL}/translate_and_speak`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        source_lang: sourceLang,
                        target_lang: targetLang
                    })
                });

                if (!audioResponse.ok) {
                    const errorData = await audioResponse.json();
                    throw new Error(`×©×’×™××ª ×©×¨×ª ××•×“×™×•: ${audioResponse.status} - ${errorData.error || '×©×’×™××” ×œ× ×™×“×•×¢×”'}. ×•×“× ×©×©×¨×ª ×”×¤×œ××¡×§ ×¤×•×¢×œ ×‘×›×ª×•×‘×ª ${SERVER_URL}.`);
                }

                const audioBlob = await audioResponse.blob();
                const audioUrl = URL.createObjectURL(audioBlob);


                // ×©×œ×‘ 2: ×‘×§×©×” × ×¤×¨×“×ª ×œ×©×¨×ª ×”×¤×œ××¡×§ ×œ×§×‘×œ×ª ×”×˜×§×¡×˜ ×”××ª×•×¨×’× ×‘×œ×‘×“
                const textResponse = await fetch(`${SERVER_URL}/translate_only`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        source_lang: sourceLang,
                        target_lang: targetLang
                    })
                });

                if (!textResponse.ok) {
                    const errorData = await textResponse.json();
                    throw new Error(`×©×’×™××ª ×©×¨×ª ×˜×§×¡×˜: ${textResponse.status} - ${errorData.error || '×©×’×™××” ×œ× ×™×“×•×¢×”'}. ×•×“× ×©×©×¨×ª ×”×¤×œ××¡×§ ×¤×•×¢×œ ×‘×›×ª×•×‘×ª ${SERVER_URL}.`);
                }

                const translatedTextResult = await textResponse.json();
                const translatedText = translatedTextResult.translatedText;

                // ×”×¤×¢×œ ××¤×§×˜ ×”×§×œ×“×”
                instantTranslationOutput.textContent = ''; // × ×§×” ×œ×¤× ×™ ×”×”×§×œ×“×”
                instantTranslationOutput.classList.add('typing-effect'); // ×”×•×¡×£ ××ª ×”×§×œ××¡ ×œ××¤×§×˜

                let i = 0;
                clearInterval(typingInterval); // × ×§×” ×›×œ ××™× ×˜×¨×•×•×œ ×§×•×“×
                typingInterval = setInterval(() => {
                    if (i < translatedText.length) {
                        instantTranslationOutput.textContent += translatedText.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingInterval);
                        instantTranslationOutput.classList.remove('typing-effect'); // ×”×¡×¨ ××ª ×”×§×œ××¡ ×‘×¡×™×•× ×”×”×§×œ×“×”
                        instantTranslationOutput.classList.add('rainbow-border'); // ×”×•×¡×£ ×× ×™××¦×™×™×ª ×§×©×ª ×‘×¢× ×Ÿ
                    }
                }, 50); // ××”×™×¨×•×ª ×”×§×œ×“×” (××™×œ×™×©× ×™×•×ª ×œ×ª×•)

                playAudio(audioUrl); // ×”×©××¢ ××ª ×”××•×“×™×•

            } catch (error) {
                console.error("×©×’×™××” ×‘×ª×¨×’×•× ××™×™×“×™:", error);
                instantTranslationOutput.textContent = `×©×’×™××” ×‘×ª×¨×’×•× ××™×™×“×™: ${error.message}. ×× × ×•×“× ×©×©×¨×ª ×”×¤×œ××¡×§ ×©×œ×š ×¤×•×¢×œ ×›×¨××•×™ (http://localhost:5000) ×•×©×”×•× ×××¤×©×¨ ×‘×§×©×•×ª CORS.`;
                instantTranslationOutput.classList.remove('rainbow-border');
                instantTranslationOutput.classList.remove('typing-effect');
                instantTranslationOutput.dir = 'rtl'; // ×‘×¨×™×¨×ª ××—×“×œ ×‘×¢×‘×¨×™×ª ×œ×©×’×™××•×ª
            }
        }


        // ----- ×œ×•×’×™×§×” ×¢×‘×•×¨ ×”××§×œ×“×ª ×•×”×ª×¨×’×•× ×”×—×•×¤×©×™ -----

        // ××ª×—×•×œ ×”××§×œ×“×ª ×”×•×•×™×¨×˜×•××œ×™×ª
        function initKeyboard() {
            const freeTextInput = document.getElementById('freeTextInput');
            keyboard = new SimpleKeyboard.default({
                input: freeTextInput, // ×§×•×©×¨ ××ª ×”××§×œ×“×ª ×œ×©×“×” ×”×˜×§×¡×˜
                layout: layoutOptions[currentKeyboardLayout], // ×¤×¨×™×¡×ª ×”××§×œ×“×ª ×”×¨××©×•× ×™×ª
                rtl: currentKeyboardLayout === 'hebrew', // ×”×’×“×¨×ª ×›×™×•×•× ×™×•×ª (RTL ×œ×¢×‘×¨×™×ª)
                onChange: input => freeTextInput.value = input, // ×¢×“×›×•×Ÿ ×©×“×” ×”×˜×§×¡×˜ ×¢× ×”×§×œ×“×ª ×”××©×ª××©
                onKeyPress: button => onKeyPress(button), // ×¤×•× ×§×¦×™×” ×œ×˜×™×¤×•×œ ×‘×œ×—×™×¦×•×ª ××§×©×™×
                theme: "hg-theme-default", // × ×•×©× ×¢×™×¦×•×‘ ×‘×¡×™×¡×™ ×©×œ simple-keyboard
                display: {
                    '{bksp}': '××—×§',
                    '{tab}': '×˜××‘',
                    '{capslock}': 'Caps Lock',
                    '{shift}': 'Shift',
                    '{space}': '×¨×•×•×—'
                }
            });

            // ×¢×“×›×•×Ÿ ×”××§×œ×“×ª ×›××©×¨ ××©×ª××© ××§×œ×™×“ ×™×©×™×¨×•×ª ×œ×©×“×” ×”×˜×§×¡×˜
            freeTextInput.addEventListener('input', event => {
                keyboard.setInput(event.target.value);
            });

            // ×”×’×“×¨ ×›×™×•×•×Ÿ ×˜×§×¡×˜ ×”×ª×—×œ×ª×™
            document.getElementById('freeTextInput').dir = currentKeyboardLayout === 'hebrew' ? 'rtl' : 'ltr';
        }

        // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×•×ª ××§×©×™× ××™×•×—×“×™× ×‘××§×œ×“×ª
        function onKeyPress(button) {
            // ×¢×‘×•×¨ Shift ××• Caps Lock, ×”×—×œ×£ ×‘×™×Ÿ ×¤×¨×™×¡×•×ª ×”××§×œ×“×ª (×¨×’×™×œ/Shift)
            if (button === "{shift}" || button === "{capslock}") {
                toggleShift();
            }
        }

        // ×”×—×œ×¤×” ×‘×™×Ÿ ××¦×‘ Shift ×œ××¦×‘ ×¨×’×™×œ ×‘××§×œ×“×ª
        function toggleShift() {
            let currentLayoutName = keyboard.options.layoutName;
            let newLayoutName = currentLayoutName === "default" ? "shift" : "default";
            keyboard.setOptions({ layoutName: newLayoutName });
        }

        // ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ "×”×§×œ×“ ×‘×¢×‘×¨×™×ª" - ××¢×‘×™×¨ ××ª ×”××§×œ×“×ª ×œ××¦×‘ ×¢×‘×¨×™×ª
        document.getElementById('setLangHe').addEventListener('click', () => {
            currentKeyboardLayout = 'hebrew';
            keyboard.setOptions({
                layout: layoutOptions['hebrew'],
                rtl: true
            });
            document.getElementById('freeTextInput').dir = 'rtl';
            keyboard.setInput(''); // × ×§×” ××ª ×©×“×” ×”×˜×§×¡×˜ ×‘×œ×—×™×¦×ª ××¢×‘×¨ ×©×¤×”
            instantTranslationOutput.classList.remove('rainbow-border'); // × ×§×” ×× ×™××¦×™×” ×××–×•×¨ ×”×ª×¨×’×•× ×”××™×™×“×™
            instantTranslationOutput.classList.remove('typing-effect');
        });

        // ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ "à¸à¸´à¸¡à¸à¹Œà¸ à¸²à¸©à¸²à¹„à¸—à¸¢" (×”×§×œ×“ ×‘×ª××™×ª) - ××¢×‘×™×¨ ××ª ×”××§×œ×“×ª ×œ××¦×‘ ×ª××™×ª
        document.getElementById('setLangTh').addEventListener('click', () => {
            currentKeyboardLayout = 'thai';
            keyboard.setOptions({
                layout: layoutOptions['thai'],
                rtl: false
            });
            document.getElementById('freeTextInput').dir = 'ltr';
            keyboard.setInput(''); // × ×§×” ××ª ×©×“×” ×”×˜×§×¡×˜ ×‘×œ×—×™×¦×ª ××¢×‘×¨ ×©×¤×”
            instantTranslationOutput.classList.remove('rainbow-border'); // × ×§×” ×× ×™××¦×™×” ×××–×•×¨ ×”×ª×¨×’×•× ×”××™×™×“×™
            instantTranslationOutput.classList.remove('typing-effect');
        });

        // ×¤×•× ×§×¦×™×™×ª ×ª×¨×’×•× ×•×”×©××¢×” ×¢×‘×•×¨ ×˜×§×¡×˜ ×—×•×¤×©×™ (××ª×§×©×¨×ª ×œ×©×¨×ª ×”×¤×œ××¡×§)
        document.getElementById('speakTranslated').addEventListener('click', async () => {
            const text = document.getElementById('freeTextInput').value.trim();
            if (!text) {
                alert("×× × ×”×§×œ×“ ×˜×§×¡×˜ ×œ×ª×¨×’×•× ×•×”×©××¢×”.");
                return;
            }

            let sourceLang; // ×©×¤×ª ×”××§×•×¨ ×©×œ ×”×˜×§×¡×˜ ×©× ×§×œ×˜
            let targetLang; // ×©×¤×ª ×”×™×¢×“ ×©×œ ×”×ª×¨×’×•× ×•×”×”×©××¢×”

            // ×§×‘×™×¢×ª ×©×¤×•×ª ×”××§×•×¨ ×•×”×™×¢×“ ×‘×”×ª×‘×¡×¡ ×¢×œ ×¤×¨×™×¡×ª ×”××§×œ×“×ª ×”× ×•×›×—×™×ª
            if (currentKeyboardLayout === 'hebrew') {
                sourceLang = 'he';
                targetLang = 'th'; // ×× ×”××©×ª××© ×›×•×ª×‘ ×‘×¢×‘×¨×™×ª, × ×ª×¨×’× ×•× ×©××™×¢ ×‘×ª××™×ª (×œ×¦×•×¨×š ×”×¢×•×‘×“)
            } else {
                sourceLang = 'th';
                targetLang = 'he'; // ×× ×”××©×ª××© ×›×•×ª×‘ ×‘×ª××™×ª, × ×ª×¨×’× ×•× ×©××™×¢ ×‘×¢×‘×¨×™×ª (×œ×¦×•×¨×š ×”×× ×”×œ)
            }

            try {
                // ×©×œ×‘ 1: ×‘×§×©×” ×œ×©×¨×ª ×”×¤×œ××¡×§ ×œ×§×‘×œ×ª ×§×•×‘×¥ ×”××•×“×™×• ×©×œ ×”×ª×¨×’×•×
                const audioResponse = await fetch(`${SERVER_URL}/translate_and_speak`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        source_lang: sourceLang,
                        target_lang: targetLang
                    })
                });

                if (!audioResponse.ok) {
                    const errorData = await audioResponse.json();
                    throw new Error(`×©×’×™××ª ×©×¨×ª ××•×“×™×•: ${audioResponse.status} - ${errorData.error || '×©×’×™××” ×œ× ×™×“×•×¢×”'}. ×•×“× ×©×©×¨×ª ×”×¤×œ××¡×§ ×¤×•×¢×œ ×‘×›×ª×•×‘×ª ${SERVER_URL}.`);
                }

                const audioBlob = await audioResponse.blob();
                const audioUrl = URL.createObjectURL(audioBlob);

                // ×©×œ×‘ 2: ×‘×§×©×” × ×¤×¨×“×ª ×œ×©×¨×ª ×”×¤×œ××¡×§ ×œ×§×‘×œ×ª ×”×˜×§×¡×˜ ×”××ª×•×¨×’× ×‘×œ×‘×“ (×œ×¦×•×¨×š ×”×¦×’×” ×‘×¤×•×¤××¤)
                const textResponse = await fetch(`${SERVER_URL}/translate_only`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        source_lang: sourceLang,
                        target_lang: targetLang
                    })
                });

                if (!textResponse.ok) {
                    const errorData = await textResponse.json();
                    throw new Error(`×©×’×™××ª ×©×¨×ª ×˜×§×¡×˜: ${textResponse.status} - ${errorData.error || '×©×’×™××” ×œ× ×™×“×•×¢×”'}. ×•×“× ×©×©×¨×ª ×”×¤×œ××¡×§ ×¤×•×¢×œ ×‘×›×ª×•×‘×ª ${SERVER_URL}.`);
                }

                const translatedTextResult = await textResponse.json();
                const translatedText = translatedTextResult.translatedText;
                const popupLang = targetLang; // ×©×¤×ª ×”×˜×§×¡×˜ ×‘×¤×•×¤××¤ ×”×™× ×©×¤×ª ×”×™×¢×“ ×©×œ ×”×ª×¨×’×•×

                showPopup(translatedText, audioUrl, popupLang); // ×”×¦×’ ××ª ×”×ª×¨×’×•× ×‘×¤×•×¤××¤ ×•×”×©××¢ ××ª ×”××•×“×™×•

            } catch (error) {
                console.error("×©×’×™××” ×‘×ª×¨×’×•× ××• ×”×©××¢×”:", error);
                alert("×©×’×™××” ×‘×ª×¨×’×•× ××• ×”×©××¢×”: " + error.message + "\n×× × ×•×“× ×©×©×¨×ª ×”×¤×œ××¡×§ ×©×œ×š ×¤×•×¢×œ ×›×¨××•×™ (http://localhost:5000) ×•×©×”×•× ×××¤×©×¨ ×‘×§×©×•×ª CORS.");
            }
        });

        // ×˜×¢×Ÿ ××ª ×”××©×¤×˜×™× ×¢× ×˜×¢×™× ×ª ×”×“×£ ×•××ª×—×œ ××ª ×”××§×œ×“×ª
        document.addEventListener('DOMContentLoaded', () => {
            loadPhrases();
            initKeyboard();
        });
    </script>

</body>
</html>
ï¿½
